<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panduan Trading Kripto Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ApexCharts for interactive candlestick simulation -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- Chosen Palette: Warm Neutrals -->
    <style>
        body {
            background-color: #FDFDFD;
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 50vh;
        }
        .indicator-chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 150px;
            max-height: 25vh;
        }
        .nav-item.active {
            background-color: #E0E7FF;
            color: #3730A3;
            font-weight: 600;
        }
        .nav-item:hover {
            background-color: #EEF2FF;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .candlestick {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 12px;
            margin: 0 1px;
        }
        .wick {
            width: 2px;
            background-color: currentColor;
        }
        .body {
            width: 100%;
        }
        .green { color: #22C55E; }
        .red { color: #EF4444; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Custom Alert Modal Styles */
        #custom-alert-modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
        }

        #custom-alert-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        #custom-alert-close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        #custom-alert-close-btn:hover,
        #custom-alert-close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Styles for the new simulation chart and news box */
        #sim-chart-container {
            max-width: 1000px;
            margin: auto;
        }
        #newsBox {
            background: #f1f5f9; /* Light background for news box */
            color: #1e293b; /* Dark text for news box */
            padding: 10px;
            border-radius: 10px;
            max-width: 600px;
            margin: 10px auto;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        #newsBox.breaking {
            background-color: #dc2626; /* Red for breaking news */
            color: white;
            animation: pulse 1s infinite;
            font-weight: bold;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        /* Timeline styles for Roadmap */
        .timeline {
            position: relative;
            margin: 0 auto;
            padding: 20px 0;
            width: 90%;
            max-width: 1200px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            width: 6px;
            background-color: #a78bfa; /* Indigo 400 */
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -3px;
        }
        .timeline-item {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
        .timeline-item.left {
            left: 0;
        }
        .timeline-item.right {
            left: 50%;
        }
        .timeline-item::after {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            right: -17px;
            background-color: white;
            border: 4px solid #a78bfa;
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }
        .timeline-item.right::after {
            left: -16px;
        }
        .timeline-item-content {
            padding: 20px 30px;
            background-color: white;
            position: relative;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .timeline-item.left .timeline-item-content {
            margin-right: 15px;
        }
        .timeline-item.right .timeline-item-content {
            margin-left: 15px;
        }
        @media screen and (max-width: 600px) {
            .timeline::before {
                left: 30px;
            }
            .timeline-item {
                width: 100%;
                padding-left: 60px;
                padding-right: 20px;
            }
            .timeline-item.right {
                left: 0%;
            }
            .timeline-item.left::after,
            .timeline-item.right::after {
                left: 20px;
            }
            .timeline-item.left .timeline-item-content,
            .timeline-item.right .timeline-item-content {
                margin: 0;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col no-scrollbar overflow-y-auto">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-indigo-700">Trader<span class="font-normal">Muda</span></h1>
                <p class="text-sm text-gray-500 mt-1">Panduan Trading Kripto</p>
            </div>
            <nav class="flex-grow px-4">
                <a href="#dasbor" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üè†</span> Dasbor
                </a>
                <a href="#dasar" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üß±</span> Dasar Kripto
                </a>
                <a href="#pilihan-koin" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üí∞</span> Pilihan Koin
                </a>
                <a href="#arena" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üìà</span> Arena Analisis
                </a>
                <a href="#simulasi" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üéÆ</span> Simulasi Trading
                </a>
                <a href="#pustaka" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üìö</span> Pustaka Pola
                </a>
                <a href="#perisai" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üõ°Ô∏è</span> Perisai Trader
                </a>
                <a href="#keamanan" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üîí</span> Keamanan
                </a>
                <a href="#hal-islam" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üïå</span> Hal Islam
                </a>
                <a href="#roadmap" class="nav-item flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200">
                    <span class="mr-3">üó∫Ô∏è</span> Roadmap Belajar
                </a>
            </nav>
            <div class="p-4 mt-auto">
                <div class="bg-indigo-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-indigo-800">Berlatih di <span class="font-bold">KriptoVerse Academy</span> untuk menjadi trader handal tanpa risiko.</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-6 md:p-10 bg-gray-50">
            <!-- Dashboard Section -->
            <section id="dasbor" class="view">
                <h2 class="text-3xl font-bold mb-2">Selamat Datang, Calon Trader!</h2>
                <p class="text-gray-600 mb-8">Ini adalah dasbor Anda untuk menaklukkan dunia trading kripto. Mulailah perjalanan Anda dari nol hingga mahir.</p>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition-shadow">
                        <h3 class="font-bold text-lg mb-2 flex items-center"><span class="mr-3 text-2xl">üß±</span> Mulai dari Dasar</h3>
                        <p class="text-gray-600 mb-4">Pahami apa itu kripto, blockchain, dan cara kerja order perdagangan.</p>
                        <a href="#dasar" class="nav-direct text-indigo-600 font-semibold hover:underline">Pelajari Sekarang &rarr;</a>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition-shadow">
                        <h3 class="font-bold text-lg mb-2 flex items-center"><span class="mr-3 text-2xl">üìà</span> Masuk ke Arena</h3>
                        <p class="text-gray-600 mb-4">Analisis grafik harga interaktif dengan berbagai indikator teknis.</p>
                        <a href="#arena" class="nav-direct text-indigo-600 font-semibold hover:underline">Mulai Analisis &rarr;</a>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition-shadow">
                        <h3 class="font-bold text-lg mb-2 flex items-center"><span class="mr-3 text-2xl">üõ°Ô∏è</span> Lindungi Modal</h3>
                        <p class="text-gray-600 mb-4">Kuasai manajemen risiko dan psikologi trading, kunci kesuksesan Anda.</p>
                        <a href="#perisai" class="nav-direct text-indigo-600 font-semibold hover:underline">Bangun Pertahanan &rarr;</a>
                    </div>
                </div>

                <div class="mt-10 bg-white p-6 rounded-xl shadow-sm">
                     <h3 class="font-bold text-xl mb-4">Tentang Aplikasi Ini</h3>
                     <p class="text-gray-600 leading-relaxed">Aplikasi ini mengubah panduan trading statis menjadi sebuah pengalaman belajar yang dinamis dan interaktif. Tujuannya adalah untuk memberikan Anda, sebagai trader muda, sebuah "tempat latihan" atau "laboratorium" di mana Anda dapat memahami konsep-konsep kompleks dengan cara yang menyenangkan dan praktis. Setiap bagian dirancang untuk membangun pengetahuan Anda secara bertahap, mulai dari fondasi teoretis hingga aplikasi praktis di 'Arena Analisis' dan penguasaan pola pikir di 'Perisai Trader'. Gunakan alat ini untuk bereksperimen, membuat "kesalahan" virtual, dan membangun kepercayaan diri sebelum terjun ke pasar nyata. </p>
                </div>
            </section>

            <!-- Dasar Kripto Section -->
            <section id="dasar" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Dasar Kripto & Mekanisme Pasar</h2>
                <div class="space-y-4" id="dasar-content"></div>
                <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">‚ú® Tanya Ahli AI</h3>
                    <p class="text-gray-600 mb-4">Ajukan pertanyaan tentang konsep dasar kripto atau trading, dan dapatkan penjelasan dari AI.</p>
                    <div class="flex flex-col sm:flex-row gap-4 mb-4">
                        <input type="text" id="ai-question-input" placeholder="Misal: Apa itu 'volume' dalam trading?" class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                        <button id="ask-ai-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors flex-shrink-0">
                            Tanya AI
                        </button>
                    </div>
                    <div id="ai-answer-result" class="mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800 hidden">
                        <p class="font-semibold mb-2">Jawaban AI:</p>
                        <div id="ai-answer-content" class="text-sm"></div>
                    </div>
                    <div id="ai-answer-loading" class="mt-4 text-center text-indigo-600 hidden">AI sedang berpikir...</div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">‚ú® Penjelasan Jargon Kripto</h3>
                    <p class="text-gray-600 mb-4">Bingung dengan istilah kripto? Masukkan jargon di sini dan biarkan AI menjelaskannya.</p>
                    <div class="flex flex-col sm:flex-row gap-4 mb-4">
                        <input type="text" id="jargon-input" placeholder="Misal: Apa itu 'HODL'?" class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 p-2">
                        <button id="explain-jargon-btn" class="bg-purple-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-purple-700 transition-colors flex-shrink-0">
                            Jelaskan Jargon
                        </button>
                    </div>
                    <div id="jargon-result" class="mt-4 p-4 bg-purple-50 rounded-lg text-purple-800 hidden">
                        <p class="font-semibold mb-2">Penjelasan AI:</p>
                        <div id="jargon-content" class="text-sm"></div>
                    </div>
                    <div id="jargon-loading" class="mt-4 text-center text-purple-600 hidden">AI sedang mencari penjelasan...</div>
                </div>
                <!-- New content for Dasar Kripto -->
                <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Crypto vs Fiat: Perbedaan Mendasar</h3>
                    <p class="text-gray-600 mb-4">Pahami mengapa kripto berbeda dari uang tradisional yang Anda gunakan sehari-hari.</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li><span class="font-semibold">Fiat:</span> Diterbitkan pemerintah, nilai dijamin kepercayaan pemerintah, terpusat (bank sentral). Contoh: Rupiah, Dolar.</li>
                        <li><span class="font-semibold">Kripto:</span> Diterbitkan melalui kode, nilai ditentukan pasar & teknologi, terdesentralisasi (blockchain). Contoh: Bitcoin, Ethereum.</li>
                    </ul>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Blockchain: Buku Besar Digital Terdistribusi</h3>
                    <p class="text-gray-600 mb-4">Bayangkan Google Docs, tapi bukan hanya Anda yang bisa mengedit. Semua orang yang berpartisipasi memiliki salinan dokumen yang sama, dan setiap perubahan diverifikasi oleh jaringan. Ini membuat data sangat aman dan transparan.</p>
                    <p class="text-gray-600 mb-4">Setiap 'blok' adalah halaman baru dalam dokumen ini yang berisi transaksi. Setelah halaman ditulis, ia 'dirantai' ke halaman sebelumnya dan tidak bisa diubah lagi. Ini adalah inti dari desentralisasi dan keamanan kripto.</p>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Konsep Penting dalam Kripto</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg text-blue-800">
                            <h4 class="font-semibold mb-2">‚õèÔ∏è Mining (Penambangan)</h4>
                            <p class="text-sm">Proses verifikasi transaksi dan penambahan blok baru ke blockchain, biasanya dengan memecahkan teka-teki komputasi yang kompleks. Ini menciptakan koin baru dan mengamankan jaringan.</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-green-800">
                            <h4 class="font-semibold mb-2">üì¶ Blok</h4>
                            <p class="text-sm">Sebuah 'paket' data yang berisi daftar transaksi yang telah diverifikasi. Setelah penuh, blok ditutup dan ditambahkan ke rantai blok (blockchain).</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-purple-800">
                            <h4 class="font-semibold mb-2">üîë Wallet Address (Alamat Dompet)</h4>
                            <p class="text-sm">Alamat unik (seperti nomor rekening bank) yang digunakan untuk mengirim dan menerima kripto. Ini adalah identitas publik Anda di blockchain.</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg text-yellow-800">
                            <h4 class="font-semibold mb-2">üìú Smart Contract</h4>
                            <p class="text-sm">Kode yang berjalan di blockchain yang secara otomatis mengeksekusi perjanjian ketika kondisi tertentu terpenuhi. Seperti 'kontrak otomatis' yang tidak bisa diubah.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Pilihan Koin/Proyek Section (NEW) -->
            <section id="pilihan-koin" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Pilihan Koin/Proyek: Memilih yang Tepat</h2>
                <p class="text-gray-600 mb-8">Memilih koin yang tepat itu seperti memilih tim olahraga yang akan Anda dukung. Ada banyak faktor yang perlu dipertimbangkan selain hanya harga!</p>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">Checklist Evaluasi Koin</h3>
                    <p class="text-gray-600 mb-4">Gunakan checklist ini untuk membantu Anda menganalisis potensi sebuah proyek kripto.</p>
                    <form id="coin-checklist-form" class="space-y-4">
                        <label class="flex items-center">
                            <input type="checkbox" name="criteria" value="marketCapVolume" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">‚úÖ Market cap & volume: Apakah proyek ini cukup besar dan likuid?</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="criteria" value="useCase" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">‚úÖ Use case nyata: Apakah ada masalah dunia nyata yang dipecahkan?</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="criteria" value="teamCommunity" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">‚úÖ Tim & komunitas: Siapa di balik proyek ini? Seberapa aktif komunitasnya?</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="criteria" value="tokenomicsVesting" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">‚úÖ Tokenomics & vesting: Bagaimana distribusi koinnya? Apakah ada jadwal rilis yang jelas?</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="criteria" value="roadmapUpdates" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">‚úÖ Roadmap & update dev: Apakah ada rencana masa depan yang jelas dan kemajuan yang konsisten?</span>
                        </label>
                        <button type="submit" class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
                            Evaluasi Pilihan Saya
                        </button>
                    </form>
                    <div id="checklist-feedback" class="mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800 hidden"></div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Studi Kasus: Koin A (Proyek Bagus) vs Koin B (Shitcoin)</h3>
                    <p class="text-gray-600 mb-4">Mari kita bedah dua contoh koin hipotetis untuk melihat perbedaannya.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-green-800">Koin A: "EcoChain" üå≥</h4>
                            <p class="text-gray-700 text-sm mb-2">EcoChain adalah platform blockchain yang berfokus pada solusi keberlanjutan lingkungan. Mereka bertujuan untuk melacak rantai pasokan karbon dan memfasilitasi perdagangan kredit karbon.</p>
                            <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                                <li>**Market Cap & Volume:** Top 50, volume harian konsisten.</li>
                                <li>**Use Case:** Jelas, memecahkan masalah nyata dalam pelacakan karbon dan keberlanjutan.</li>
                                <li>**Tim & Komunitas:** Tim yang berpengalaman di bidang teknologi dan lingkungan, komunitas aktif dan terlibat.</li>
                                <li>**Tokenomics & Vesting:** Suplai terbatas, distribusi adil, jadwal vesting transparan untuk tim dan investor awal.</li>
                                <li>**Roadmap & Update Dev:** Roadmap jelas dengan pencapaian yang konsisten dan update pengembangan rutin.</li>
                            </ul>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-red-800">Koin B: "MoonPump" üåïüöÄ</h4>
                            <p class="text-gray-700 text-sm mb-2">MoonPump adalah koin meme baru yang dijanjikan akan "to the moon" tanpa use case yang jelas. Fokus utamanya adalah pemasaran agresif di media sosial.</p>
                            <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                                <li>**Market Cap & Volume:** Sangat rendah, volume fluktuatif dan didorong oleh hype.</li>
                                <li>**Use Case:** Tidak ada use case nyata, hanya janji keuntungan cepat.</li>
                                <li>**Tim & Komunitas:** Tim anonim, komunitas didominasi oleh spekulan dan influencer yang dibayar.</li>
                                <li>**Tokenomics & Vesting:** Suplai sangat besar, distribusi tidak jelas, seringkali ada alamat dompet besar yang memegang sebagian besar suplai.</li>
                                <li>**Roadmap & Update Dev:** Roadmap tidak realistis atau tidak ada, tidak ada update pengembangan yang berarti.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Arena Analisis Section -->
            <section id="arena" class="view hidden">
                 <h2 class="text-3xl font-bold mb-2">Arena Analisis</h2>
                 <p class="text-gray-600 mb-6">Gunakan widget TradingView interaktif di bawah ini untuk menganalisis pergerakan harga secara langsung.</p>

                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <!-- TradingView Widget BEGIN -->
                    <div class="tradingview-widget-container">
                        <div id="tradingview_chart"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                        <script type="text/javascript">
                        new TradingView.widget({
                            "width": "100%", // Make it responsive
                            "height": 500, // Adjust height as needed
                            "symbol": "BINANCE:SOLUSDT", // Default symbol, can be changed dynamically if needed
                            "interval": "1",
                            "timezone": "Etc/UTC",
                            "theme": "light",
                            "style": "1",
                            "locale": "en",
                            "enable_publishing": false,
                            "hide_top_toolbar": false, // Keep toolbar for more features
                            "container_id": "tradingview_chart"
                        });
                        </script>
                    </div>
                    <!-- TradingView Widget END -->

                    <div class="mt-8 pt-6 border-t border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Ide Trading dari AI</h3>
                            <p class="text-gray-600 mb-4">Dapatkan contoh ide trading hipotetis berdasarkan koin yang dipilih. Ini hanyalah simulasi untuk belajar, bukan nasihat finansial.</p>
                            <button id="generate-trade-idea-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-indigo-700 transition-colors flex items-center justify-center w-full">
                                ‚ú® Hasilkan Ide Trading
                            </button>
                            <div id="trade-idea-result" class="mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800 hidden">
                                <p class="font-semibold mb-2">Ide Trading:</p>
                                <div id="trade-idea-content" class="text-sm"></div>
                            </div>
                            <div id="trade-idea-loading" class="mt-4 text-center text-indigo-600 hidden">Memikirkan ide trading...</div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Analisis Sentimen Pasar AI</h3>
                            <p class="text-gray-600 mb-4">Dapatkan gambaran singkat sentimen pasar (bullish/bearish/netral) untuk koin yang dipilih.</p>
                            <button id="generate-sentiment-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors flex items-center justify-center w-full">
                                ‚ú® Dapatkan Sentimen
                            </button>
                            <div id="sentiment-result" class="mt-4 p-4 bg-green-50 rounded-lg text-green-800 hidden">
                                <p class="font-semibold mb-2">Sentimen AI:</p>
                                <div id="sentiment-content" class="text-sm"></div>
                            </div>
                            <div id="sentiment-loading" class="mt-4 text-center text-green-600 hidden">Menganalisis sentimen...</div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Simulasi Skenario Perdagangan</h3>
                            <p class="text-gray-600 mb-4">Masukkan skenario pasar hipotetis dan lihat bagaimana seorang trader mungkin bereaksi.</p>
                            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                                <input type="text" id="scenario-input" placeholder="Misal: Bitcoin tiba-tiba turun 10% karena berita regulasi..." class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 p-2">
                                <button id="simulate-scenario-btn" class="bg-purple-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-purple-700 transition-colors flex-shrink-0">
                                    Simulasikan
                                </button>
                            </div>
                            <div id="scenario-result" class="mt-4 p-4 bg-purple-50 rounded-lg text-purple-800 hidden">
                                <p class="font-semibold mb-2">Respons AI:</p>
                                <div id="scenario-content" class="text-sm"></div>
                            </div>
                            <div id="scenario-loading" class="mt-4 text-center text-purple-600 hidden">Menjalankan simulasi...</div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Ringkasan Berita Kripto (Hipotetis)</h3>
                            <p class="text-gray-600 mb-4">Dapatkan ringkasan berita hipotetis dan potensi dampaknya pada koin yang dipilih.</p>
                            <button id="generate-news-summary-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center w-full">
                                ‚ú® Hasilkan Berita
                            </button>
                            <div id="news-summary-result" class="mt-4 p-4 bg-blue-50 rounded-lg text-blue-800 hidden">
                                <p class="font-semibold mb-2">Berita AI:</p>
                                <div id="news-summary-content" class="text-sm"></div>
                            </div>
                            <div id="news-summary-loading" class="mt-4 text-center text-blue-600 hidden">Membuat ringkasan berita...</div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-xl font-bold mb-4">‚ú® Prediksi Tren Jangka Pendek (Hipotetis)</h3>
                        <p class="text-gray-600 mb-4">Dapatkan simulasi prediksi tren jangka pendek untuk koin yang dipilih. Ini hanya untuk tujuan edukasi.</p>
                        <button id="predict-trend-btn" class="bg-orange-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-orange-700 transition-colors flex items-center justify-center w-full">
                            ‚ú® Prediksi Tren
                        </button>
                        <div id="trend-prediction-result" class="mt-4 p-4 bg-orange-50 rounded-lg text-orange-800 hidden">
                            <p class="font-semibold mb-2">Prediksi AI:</p>
                            <div id="trend-prediction-content" class="text-sm"></div>
                        </div>
                        <div id="trend-prediction-loading" class="mt-4 text-center text-orange-600 hidden">AI sedang memprediksi...</div>
                    </div>
                </div>
            </section>

            <!-- Arena Simulasi Trading Section -->
            <section id="simulasi" class="view hidden">
                <h2 class="text-3xl font-bold mb-2">Arena Simulasi Trading</h2>
                <p class="text-gray-600 mb-6">Berlatih trading dengan modal virtual dan rasakan dinamika pasar, termasuk reaksi terhadap berita mendadak!</p>

                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <div id="sim-controls" class="flex flex-col sm:flex-row gap-4 mb-6 items-center justify-between">
                        <div class="flex items-center gap-4">
                            <label for="sim-coin-select" class="block text-sm font-medium text-gray-700">Pilih Koin:</label>
                            <select id="sim-coin-select" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></select>
                        </div>
                        <div class="flex gap-2">
                            <!-- Overall Start/Reset buttons -->
                            <button id="sim-start-sim-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                                Mulai Simulasi
                            </button>
                            <button id="sim-reset-sim-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors hidden">
                                Reset Simulasi
                            </button>
                        </div>
                    </div>

                    <div id="sim-info" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-100 p-4 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Saldo USDT Anda:</p>
                            <p id="sim-balance" class="text-xl font-bold text-gray-800">$10,000.00</p>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Harga Saat Ini (<span id="sim-current-coin-display">BTC</span>):</p>
                            <p id="sim-current-price" class="text-xl font-bold text-gray-800">$0.00</p>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Koin Anda (<span id="sim-holding-coin-display">BTC</span>):</p>
                            <p id="sim-coin-holding" class="text-xl font-bold text-gray-800">0.00</p>
                        </div>
                        <!-- Added totalValue element here -->
                        <div class="bg-gray-100 p-4 rounded-lg text-center col-span-full md:col-span-1">
                            <p class="text-sm text-gray-600">Total Nilai Portofolio:</p>
                            <p id="totalValue" class="text-xl font-bold text-gray-800">$10,000.00</p>
                        </div>
                    </div>

                    <div id="sim-pnl-info" class="bg-gray-100 p-4 rounded-lg text-center mb-6 hidden">
                        <p class="text-sm text-gray-600">Keuntungan/Kerugian Mengambang:</p>
                        <p id="sim-pnl" class="text-xl font-bold text-gray-800">$0.00</p>
                    </div>

                    <!-- Candlestick Example for Simulation Trading -->
                    <div class="flex justify-center items-center h-12 mb-4">
                        <span class="text-sm text-gray-600 mr-2">Contoh Candlestick:</span>
                        <div id="sim-candlestick-examples" class="flex items-end h-12"></div>
                    </div>

                    <!-- ApexCharts Simulation Chart & Controls -->
                    <div id="sim-chart-container" class="w-full border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4 items-center justify-center p-4">
                            <label for="sim-timeframe" class="block text-sm font-medium text-gray-700">Timeframe:</label>
                            <select id="sim-timeframe" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                <option value="1000">1 Detik</option>
                                <option value="3000">3 Detik</option>
                                <option value="5000">5 Detik</option>
                                <option value="10000">10 Detik</option>
                                <option value="60000">1 Menit</option>
                                <option value="300000">5 Menit</option>
                                <option value="900000">15 Menit</option>
                                <option value="1800000">30 Menit</option>
                                <option value="3600000">1 Jam</option>
                                <option value="86400000">1 Hari</option>
                            </select>
                            <button id="sim-chart-pauseBtn" class="bg-amber-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-amber-700 transition-colors">‚è∏Ô∏è Pause</button>
                            <button id="sim-chart-resumeBtn" class="bg-emerald-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-emerald-700 transition-colors">‚ñ∂Ô∏è Resume</button>
                        </div>
                        <div id="chart" style="height: 350px;"></div>
                        <div id="volumeChart" style="height: 150px;"></div>
                        <div id="chart-info" class="text-center mt-2 mb-4">
                            <span id="price" class="font-semibold text-lg">Harga: $0.00</span>
                            <span id="change" class="ml-4 font-semibold text-lg">Change: 0%</span>
                            <span id="direction" class="ml-2 text-xl">‚¨ç</span>
                        </div>
                    </div>

                    <!-- Analisis Teknikal Interaktif Module -->
                    <div class="mt-8 pt-6 border-t border-gray-200 bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Analisis Teknikal Interaktif (dengan Candlestick)</h3>
                        <p class="text-gray-600 mb-4">Uji pemahaman Anda tentang konsep teknikal analisis dasar dengan contoh candlestick.</p>

                        <div class="mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                            <h4 class="font-semibold text-lg mb-3 text-blue-800">Kuis: Support atau Resistance?</h4>
                            <p class="text-gray-700 mb-4">Lihat gambar candlestick di bawah. Apakah garis putus-putus ini menunjukkan level Support atau Resistance?</p>
                            <div class="flex justify-center mb-4">
                                <!-- Example Candlestick for Quiz -->
                                <div class="relative flex items-end h-24">
                                    <div class="candlestick green" style="height: 60px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 50px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick green" style="height: 70px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 60px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick green" style="height: 65px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 55px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick red" style="height: 40px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 30px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick red" style="height: 50px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 40px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick red" style="height: 45px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 35px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <!-- Dashed line representing resistance -->
                                    <div style="position: absolute; top: 10px; left: 0; right: 0; border-top: 2px dashed #9333ea; width: 100%; height: 2px;"></div>
                                </div>
                            </div>
                            <div class="flex justify-center gap-4">
                                <button class="quiz-answer-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" data-answer="resistance">Resistance</button>
                                <button class="quiz-answer-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" data-answer="support">Support</button>
                            </div>
                            <div id="quiz-feedback-sr" class="mt-4 p-3 rounded-lg hidden"></div>
                        </div>

                        <div class="mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50">
                            <h4 class="font-semibold text-lg mb-3 text-purple-800">Kuis: Apakah Ini Bisa Breakout?</h4>
                            <p class="text-gray-700 mb-4">Perhatikan pola candlestick ini. Apakah ini menunjukkan potensi breakout ke atas dari level resistance?</p>
                            <div class="flex justify-center mb-4">
                                <!-- Example Candlestick for Breakout Quiz -->
                                <div class="relative flex items-end h-24">
                                    <div class="candlestick green" style="height: 30px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 20px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick green" style="height: 35px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 25px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick green" style="height: 40px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 30px;"></div><div class="wick" style="height: 5px;"></div></div>
                                    <div class="candlestick green" style="height: 70px;"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 60px;"></div><div class="wick" style="height: 5px;"></div></div> <!-- Large bullish candle -->
                                    <!-- Dashed line representing resistance -->
                                    <div style="position: absolute; top: 30px; left: 0; right: 0; border-top: 2px dashed #059669; width: 100%; height: 2px;"></div>
                                </div>
                            </div>
                            <div class="flex justify-center gap-4">
                                <button class="quiz-answer-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700" data-answer="yes">Ya, potensi breakout</button>
                                <button class="quiz-answer-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700" data-answer="no">Tidak yakin / Tidak</button>
                            </div>
                            <div id="quiz-feedback-breakout" class="mt-4 p-3 rounded-lg hidden"></div>
                        </div>

                        <h4 class="font-semibold text-lg mb-3">Kartu Edukasi Indikator & Pola Candlestick</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h5 class="font-bold text-md mb-2">RSI (Relative Strength Index)</h5>
                                <p class="text-sm text-gray-700">Mengukur kecepatan dan perubahan pergerakan harga. Membantu mengidentifikasi kondisi overbought (di atas 70) atau oversold (di bawah 30).</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h5 class="font-bold text-md mb-2">MACD (Moving Average Convergence Divergence)</h5>
                                <p class="text-sm text-gray-700">Mengungkap momentum, arah, dan durasi tren harga. Sinyal beli/jual sering terjadi saat garis MACD melintasi garis sinyal.</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h5 class="font-bold text-md mb-2">SMA (Simple Moving Average)</h5>
                                <p class="text-sm text-gray-700">Menghaluskan data harga untuk menciptakan garis tren. Digunakan untuk mengidentifikasi arah tren dan level support/resistance dinamis.</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h5 class="font-bold text-md mb-2">Pola Candlestick Pembalikan</h5>
                                <p class="text-sm text-gray-700">Formasi seperti Hammer, Doji, dan Engulfing menunjukkan potensi perubahan arah tren. Pelajari lebih lanjut di <a href="#pustaka" class="text-indigo-600 hover:underline">Pustaka Pola</a>.</p>
                            </div>
                        </div>
                    </div>

                    <div id="sim-trade-actions" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-lg mb-3 text-green-800">Beli Koin</h4>
                            <div class="flex flex-col gap-3">
                                <input type="number" id="buy-amount" placeholder="Jumlah USDT untuk dibeli" class="rounded-md border-green-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2">
                                <button id="buy-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-green-700 transition-colors">
                                    Beli <span id="buy-coin-display">BTC</span>
                                </button>
                            </div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-lg mb-3 text-red-800">Jual Koin</h4>
                            <div class="flex flex-col gap-3">
                                <input type="number" id="sell-amount" placeholder="Jumlah koin untuk dijual" class="rounded-md border-red-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2">
                                <button id="sell-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors">
                                    Jual <span id="sell-coin-display">BTC</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- New AI-powered features for Simulation -->
                    <div class="mt-8 pt-6 border-t border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Analisis Perdagangan AI</h3>
                            <p class="text-gray-600 mb-4">Dapatkan analisis AI singkat tentang transaksi terakhir Anda.</p>
                            <button id="analyze-trade-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-indigo-700 transition-colors flex items-center justify-center w-full">
                                ‚ú® Analisis Perdagangan
                            </button>
                            <div id="trade-analysis-result" class="mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800 hidden">
                                <p class="font-semibold mb-2">Analisis AI:</p>
                                <div id="trade-analysis-content" class="text-sm"></div>
                            </div>
                            <div id="trade-analysis-loading" class="mt-4 text-center text-indigo-600 hidden">AI sedang menganalisis...</div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">‚ú® Saran Strategi AI</h3>
                            <p class="text-gray-600 mb-4">Dapatkan saran strategi trading umum berdasarkan kondisi pasar simulasi saat ini.</p>
                            <button id="suggest-strategy-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors flex items-center justify-center w-full">
                                ‚ú® Saran Strategi
                            </button>
                            <div id="strategy-suggestion-result" class="mt-4 p-4 bg-green-50 rounded-lg text-green-800 hidden">
                                <p class="font-semibold mb-2">Saran AI:</p>
                                <div id="strategy-suggestion-content" class="text-sm"></div>
                            </div>
                            <div id="strategy-suggestion-loading" class="mt-4 text-center text-green-600 hidden">AI sedang menyarankan...</div>
                        </div>
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-xl font-bold mb-4">‚ú® Evaluasi Portofolio AI</h3>
                        <p class="text-gray-600 mb-4">Dapatkan evaluasi kinerja portofolio Anda dari AI.</p>
                        <button id="evaluate-portfolio-btn" class="bg-purple-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-700 transition-colors flex items-center justify-center w-full">
                            ‚ú® Evaluasi Portofolio
                        </button>
                        <div id="portfolio-evaluation-result" class="mt-4 p-4 bg-purple-50 rounded-lg text-purple-800 hidden">
                            <p class="font-semibold mb-2">Evaluasi AI:</p>
                            <div id="portfolio-evaluation-content" class="text-sm"></div>
                        </div>
                        <div id="portfolio-evaluation-loading" class="mt-4 text-center text-purple-600 hidden">AI sedang mengevaluasi...</div>
                    </div>

                    <div id="news" class="mt-6">
                        <h3 class="text-xl font-bold mb-2">üì∞ Berita Pasar</h3>
                        <div id="newsBox" class="p-4 text-center">Tidak ada berita saat ini...</div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-xl font-bold mb-4">Log Transaksi</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Waktu</th>
                                        <th scope="col" class="px-6 py-3">Koin</th>
                                        <th scope="col" class="px-6 py-3">Aksi</th>
                                        <th scope="col" class="px-6 py-3">Jumlah</th>
                                        <th scope="col" class="px-6 py-3">Harga</th>
                                        <th scope="col" class="px-6 py-3">Total USDT</th>
                                        <th scope="col" class="px-6 py-3">P/L (%)</th>
                                        <th scope="col" class="px-6 py-3">P/L ($)</th>
                                    </tr>
                                </thead>
                                <tbody id="transaction-log-body">
                                    <!-- Transaction rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pustaka Pola Section -->
            <section id="pustaka" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Pustaka Pola</h2>
                <div class="mb-8">
                     <h3 class="text-2xl font-semibold mb-2">Pola Candlestick</h3>
                     <p class="text-gray-600 mb-4">Kenali sinyal pasar melalui formasi lilin individu. Klik setiap kartu untuk detail.</p>
                     <div id="candlestick-patterns-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
                <div>
                     <h3 class="text-2xl font-semibold mb-2">Pola Grafik</h3>
                      <p class="text-gray-600 mb-4">Identifikasi formasi harga yang lebih besar yang menandakan pembalikan atau kelanjutan tren.</p>
                     <div id="chart-patterns-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
            </section>

            <!-- Perisai Trader Section -->
            <section id="perisai" class="view hidden">
                 <h2 class="text-3xl font-bold mb-6">Perisai Trader: Risiko & Psikologi</h2>
                 <p class="text-gray-600 mb-8">Bab ini adalah fondasi kesuksesan jangka panjang. Kuasai ini, dan Anda akan selangkah lebih maju dari yang lain.</p>
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Kalkulator Manajemen Risiko</h3>
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-semibold text-lg mb-2">Ukuran Posisi (Aturan 1%)</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="pos-size-account" class="text-sm">Ukuran Akun ($)</label>
                                        <input type="number" id="pos-size-account" value="10000" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                    <div>
                                        <label for="pos-size-risk" class="text-sm">Risiko (%)</label>
                                        <input type="number" id="pos-size-risk" value="1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                    <div>
                                        <label for="pos-size-entry" class="text-sm">Harga Masuk</label>
                                        <input type="number" id="pos-size-entry" placeholder="cth: 50000" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                    <div>
                                        <label for="pos-size-sl" class="text-sm">Harga Stop-Loss</label>
                                        <input type="number" id="pos-size-sl" placeholder="cth: 49500" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                </div>
                                <div id="pos-size-result" class="mt-4 text-center bg-indigo-50 p-3 rounded-lg font-semibold text-indigo-800">Masukkan harga untuk menghitung.</div>
                            </div>
                            <hr/>
                            <div>
                                <h4 class="font-semibold text-lg mb-2">Rasio Risiko-Imbalan</h4>
                                <div class="grid grid-cols-1 gap-4">
                                     <div>
                                        <label for="rr-entry" class="text-sm">Harga Masuk</label>
                                        <input type="number" id="rr-entry" placeholder="cth: 50000" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                    <div>
                                        <label for="rr-tp" class="text-sm">Harga Take-Profit</label>
                                        <input type="number" id="rr-tp" placeholder="cth: 51000" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                     <div>
                                        <label for="rr-sl" class="text-sm">Harga Stop-Loss</label>
                                        <input type="number" id="rr-sl" placeholder="cth: 49500" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                                    </div>
                                </div>
                                <div id="rr-result" class="mt-4 text-center bg-green-50 p-3 rounded-lg font-semibold text-green-800">Masukkan harga untuk menghitung.</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Menguasai Pikiran Anda</h3>
                        <div id="psychology-content"></div>
                        <!-- New content for Psychology & Risk -->
                        <div class="mt-8">
                            <h4 class="font-semibold text-lg mb-2">Jurnal Trading: Peta Jalan Anda Menuju Disiplin</h4>
                            <p class="text-gray-600 mb-4">Jurnal trading adalah alat paling ampuh untuk peningkatan. Ini bukan hanya tentang mencatat angka, tapi juga emosi dan pelajaran dari setiap perdagangan.</p>
                            <ul class="list-disc list-inside text-gray-700 space-y-2">
                                <li>**Catat:** Tanggal, koin, aksi (beli/jual), harga masuk/keluar, ukuran posisi, P/L.</li>
                                <li>**Analisis:** Mengapa Anda masuk? Apa yang Anda harapkan? Apa yang sebenarnya terjadi?</li>
                                <li>**Refleksi:** Bagaimana perasaan Anda selama perdagangan? Apakah Anda mengikuti rencana? Apa pelajaran yang bisa diambil?</li>
                            </ul>
                        </div>
                        <div class="mt-8">
                            <h4 class="font-semibold text-lg mb-2">Infografis: FOMO vs FUD</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="bg-yellow-50 p-4 rounded-lg text-yellow-800">
                                    <h5 class="font-bold text-md mb-2">üò± FOMO (Fear Of Missing Out)</h5>
                                    <p class="text-sm">Dorongan untuk membeli saat harga melonjak karena takut ketinggalan. Seringkali membeli di puncak.</p>
                                    <p class="text-sm mt-2 font-semibold">Cara Menghindari: Tetap pada rencana, jangan kejar harga, selalu ada peluang lain.</p>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg text-red-800">
                                    <h5 class="font-bold text-md mb-2">üò® FUD (Fear, Uncertainty, Doubt)</h5>
                                    <p class="text-sm">Ketakutan, ketidakpastian, dan keraguan yang menyebabkan penjualan panik. Seringkali menjual di dasar.</p>
                                    <p class="text-sm mt-2 font-semibold">Cara Menghindari: Lakukan riset sendiri, jangan panik, percaya pada analisis fundamental jangka panjang.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Jurnal Perdagangan: Peta Jalan Anda</h3>
                    <p class="text-gray-600 mb-4">Jurnal adalah alat paling ampuh untuk peningkatan. Gunakan struktur ini untuk melacak dan belajar dari setiap perdagangan (bahkan yang simulasi).</p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Item</th>
                                    <th scope="col" class="px-6 py-3">Contoh Catatan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b"><td class="px-6 py-4 font-semibold" colspan="2">Pra-Perdagangan</td></tr>
                                <tr class="bg-white border-b"><td class="px-6 py-4">Alasan Masuk</td><td class="px-6 py-4">BTC/USDT: Breakout dari pola segitiga naik di grafik 4jam, dikonfirmasi volume.</td></tr>
                                <tr class="bg-white border-b"><td class="px-6 py-4">Stop-Loss</td><td class="px-6 py-4">Ditetapkan di $68,500, sedikit di bawah support garis tren bawah.</td></tr>
                                <tr class="bg-white border-b"><td class="px-6 py-4 font-semibold" colspan="2">Pasca-Perdagangan</td></tr>
                                <tr class="bg-white border-b"><td class="px-6 py-4">Hasil</td><td class="px-6 py-4">Keluar di TP $71,000. Keuntungan +2.5%.</td></tr>
                                <tr class="bg-white border-b"><td class="px-6 py-4">Pelajaran</td><td class="px-6 py-4">Strategi breakout berhasil. Kesabaran menunggu konfirmasi volume terbayar.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Keamanan Section (NEW) -->
            <section id="keamanan" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Keamanan di Dunia Kripto: Lindungi Aset Anda</h2>
                <p class="text-gray-600 mb-8">Dunia kripto menawarkan kebebasan finansial, tetapi juga penuh dengan risiko jika Anda tidak hati-hati. Keamanan adalah prioritas utama!</p>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">CEX (Centralized Exchange) vs DEX (Decentralized Exchange)</h3>
                    <p class="text-gray-600 mb-4">Pahami perbedaan platform tempat Anda berdagang.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg text-blue-800">
                            <h4 class="font-bold text-md mb-2">CEX (Bursa Terpusat)</h4>
                            <p class="text-sm">Contoh: Binance, Indodax. Anda mempercayakan aset Anda kepada pihak ketiga. Mudah digunakan, likuiditas tinggi, tapi rentan peretasan pusat.</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-green-800">
                            <h4 class="font-bold text-md mb-2">DEX (Bursa Terdesentralisasi)</h4>
                            <p class="text-sm">Contoh: Uniswap, PancakeSwap. Anda memegang kendali penuh atas aset Anda (non-custodial). Lebih aman dari peretasan pusat, tapi lebih kompleks dan likuiditas bisa lebih rendah.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">Cara Aman Menyimpan Private Key & Seed Phrase</h3>
                    <p class="text-gray-600 mb-4">Ini adalah kunci harta karun Anda! Jangan pernah memberikannya kepada siapa pun.</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>**Tulis di kertas:** Simpan di tempat yang aman (brankas, safety deposit box). Buat beberapa salinan.</li>
                        <li>**Jangan simpan digital:** Hindari menyimpan di komputer, ponsel, cloud, atau email.</li>
                        <li>**Gunakan Hardware Wallet:** Perangkat fisik yang menyimpan kunci Anda secara offline (misal: Ledger, Trezor). Ini adalah cara paling aman.</li>
                        <li>**Hafalkan (opsional):** Jika Anda memiliki seed phrase yang pendek dan bisa dihafal, ini bisa menjadi lapisan keamanan tambahan, tapi tetap miliki salinan fisik.</li>
                    </ul>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">Checklist Verifikasi: Hindari Penipuan!</h3>
                    <p class="text-gray-600 mb-4">Sebelum mengklik link atau berinteraksi dengan kontrak, selalu periksa ini:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>**Periksa URL:** Pastikan URL situs web adalah yang resmi (misal: `binance.com` bukan `binnance.com`). Perhatikan ejaan yang salah!</li>
                        <li>**Verifikasi Kontrak Token:** Saat berinteraksi dengan token baru di DEX, selalu periksa alamat kontraknya di CoinGecko atau CoinMarketCap untuk memastikan itu adalah kontrak yang sah.</li>
                        <li>**Jangan Percaya Airdrop Palsu:** Jika terlalu bagus untuk menjadi kenyataan (misal: "Kirim 0.1 ETH untuk menerima 10 ETH"), itu adalah scam.</li>
                        <li>**Phishing Email/DM:** Jangan pernah mengklik link dari email atau pesan yang mencurigakan yang meminta private key atau seed phrase Anda. Bursa atau dompet tidak akan pernah meminta itu.</li>
                    </ul>
                    <div class="mt-4 p-4 bg-red-100 rounded-lg text-red-800">
                        <p class="font-semibold mb-2">Contoh Scam Umum:</p>
                        <p class="text-sm">
                            **Phishing Email:** Anda mungkin menerima email yang terlihat seperti dari bursa favorit Anda, meminta Anda untuk "memverifikasi akun" dengan mengklik tautan. Tautan tersebut akan membawa Anda ke situs palsu yang terlihat persis sama, dan jika Anda memasukkan kredensial Anda, mereka akan mencurinya. <br/>
                             <br/>
                            **Rug Pull:** Proyek baru menjanjikan keuntungan besar, menarik banyak investor, lalu tim menghilang dengan semua dana. Tidak ada use case nyata, tim anonim, dan likuiditas tiba-tiba ditarik.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Hal Islam Section (NEW) -->
            <section id="hal-islam" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Kripto dalam Pandangan Islam (Syariah)</h2>
                <p class="text-gray-600 mb-8">Bagi sebagian umat Muslim, memahami status halal atau haramnya kripto adalah hal penting. Mari kita telusuri pandangan syariah.</p>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">Fatwa MUI & Perbedaan Pendapat Ulama</h3>
                    <p class="text-gray-600 mb-4">Majelis Ulama Indonesia (MUI) telah mengeluarkan fatwa tentang kripto, namun ada juga pandangan dari ulama internasional.</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>**Fatwa DSN-MUI:** Dewan Syariah Nasional MUI menyatakan kripto sebagai aset digital yang sah untuk diperdagangkan, asalkan memenuhi syarat sebagai komoditas atau aset yang memiliki manfaat, tidak mengandung gharar (ketidakpastian berlebihan), dharar (bahaya), dan riba. Namun, penggunaan kripto sebagai mata uang (alat tukar) masih diperdebatkan dan cenderung tidak diperbolehkan.</li>
                        <li>**Mufti Taqi Usmani:** Ulama terkemuka ini berpendapat bahwa mata uang kripto tidak memenuhi definisi mata uang syariah karena tidak memiliki dukungan fisik dan volatilitasnya tinggi, sehingga lebih mirip komoditas atau saham. Pandangannya cenderung konservatif terhadap penggunaan kripto sebagai mata uang.</li>
                        <li>**Perbedaan Pendapat:** Ada ulama lain yang memiliki pandangan lebih longgar, menganggap kripto sebagai aset yang sah jika digunakan untuk tujuan yang halal dan tidak melanggar prinsip syariah.</li>
                    </ul>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <h3 class="text-xl font-bold mb-4">Kriteria Trading Kripto yang Halal (Menurut Mayoritas Ulama)</h3>
                    <p class="text-gray-600 mb-4">Untuk memastikan trading Anda sesuai syariah, perhatikan kriteria berikut:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li><span class="font-semibold">üö´ Tanpa Leverage/Margin:</span> Hindari perdagangan dengan utang atau pinjaman berbunga (riba).</li>
                        <li><span class="font-semibold">‚úÖ Bebas Riba:</span> Pastikan transaksi tidak melibatkan bunga atau elemen riba lainnya.</li>
                        <li><span class="font-semibold">üí∞ Tidak Spekulatif Berlebihan:</span> Trading harus didasari analisis dan tujuan investasi yang jelas, bukan hanya judi atau untung-untungan.</li>
                        <li><span class="font-semibold">üìà Ada Manfaat Riil:</span> Koin yang diperdagangkan harus memiliki use case atau nilai intrinsik yang jelas, bukan hanya koin meme tanpa fundamental.</li>
                    </ul>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Checklist Syariah Koin</h3>
                    <p class="text-gray-600 mb-4">Gunakan ini untuk mengevaluasi apakah sebuah koin cenderung halal atau haram untuk diperdagangkan.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 rounded-lg bg-green-50 text-green-800">
                            <h4 class="font-bold text-lg mb-2">‚úÖ Cenderung Halal</h4>
                            <ul class="list-disc list-inside text-sm space-y-1">
                                <li>**Utility Koin Jelas:** Koin memiliki fungsi nyata (misal: untuk pembayaran, smart contract, tata kelola).</li>
                                <li>**Transparansi Dev:** Tim pengembang dikenal dan transparan.</li>
                                <li>**Tidak Manipulatif:** Proyek tidak terlibat dalam skema pump-and-dump atau manipulasi pasar.</li>
                                <li>**Aset Dasar Halal:** Jika token merepresentasikan aset, aset tersebut harus halal.</li>
                            </ul>
                        </div>
                        <div class="p-4 rounded-lg bg-red-50 text-red-800">
                            <h4 class="font-bold text-lg mb-2">‚ùå Cenderung Haram</h4>
                            <ul class="list-disc list-inside text-sm space-y-1">
                                <li>**Koin Meme Tanpa Utility:** Koin yang hanya didasari hype tanpa fungsi nyata.</li>
                                <li>**Proyek Anonim/Tidak Jelas:** Tim tidak dikenal, tujuan proyek tidak transparan.</li>
                                <li>**Skema Ponzi/Piramida:** Janji keuntungan tidak realistis, mengandalkan rekrutmen anggota baru.</li>
                                <li>**Terlibat Judi/Riba:** Proyek yang memfasilitasi aktivitas haram seperti judi atau riba.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Roadmap / Belajar Section (NEW) -->
            <section id="roadmap" class="view hidden">
                <h2 class="text-3xl font-bold mb-6">Roadmap Belajar Trading Kripto</h2>
                <p class="text-gray-600 mb-8">Perjalanan menjadi trader handal membutuhkan tahapan. Ikuti roadmap ini untuk panduan belajar Anda!</p>

                <div class="timeline">
                    <div class="timeline-item left">
                        <div class="timeline-item-content bg-indigo-50">
                            <h3 class="font-bold text-lg text-indigo-800">Tahap 1: Blockchain & Kripto Dasar</h3>
                            <p class="text-sm text-gray-700">Durasi: 2 Minggu</p>
                            <p class="text-sm mt-2">Pahami fondasi teknologi di balik kripto. Apa itu blockchain, desentralisasi, mining, dan bagaimana transaksi bekerja.</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Apa itu Bitcoin & Ethereum</li>
                                <li>Konsep Private Key & Public Key</li>
                                <li>Jenis-jenis Wallet (Hot vs Cold)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item right">
                        <div class="timeline-item-content bg-purple-50">
                            <h3 class="font-bold text-lg text-purple-800">Tahap 2: Analisis Fundamental (FA)</h3>
                            <p class="text-sm text-gray-700">Durasi: 1-2 Minggu</p>
                            <p class="text-sm mt-2">Belajar mengevaluasi nilai intrinsik sebuah proyek kripto. Fokus pada "mengapa" sebuah koin berharga.</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Market Cap & Volume</li>
                                <li>Use Case & Teknologi Proyek</li>
                                <li>Tim, Komunitas, & Kemitraan</li>
                                <li>Tokenomics & Vesting Schedule</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item left">
                        <div class="timeline-item-content bg-green-50">
                            <h3 class="font-bold text-lg text-green-800">Tahap 3: Analisis Teknikal (TA)</h3>
                            <p class="text-sm text-gray-700">Durasi: 1-2 Minggu</p>
                            <p class="text-sm mt-2">Pelajari cara membaca grafik harga dan memprediksi pergerakan harga di masa depan. Fokus pada "kapan" harus masuk/keluar.</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Pola Candlestick & Grafik</li>
                                <li>Support & Resistance</li>
                                <li>Indikator Populer (RSI, MACD, MA)</li>
                                <li>Volume Trading</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item right">
                        <div class="timeline-item-content bg-yellow-50">
                            <h3 class="font-bold text-lg text-yellow-800">Tahap 4: Psikologi & Manajemen Risiko</h3>
                            <p class="text-sm text-gray-700">Durasi: Fleksibel (Berlatih Sepanjang Waktu)</p>
                            <p class="text-sm mt-2">Ini adalah kunci kesuksesan jangka panjang. Kuasai emosi Anda dan lindungi modal Anda.</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Mengelola Emosi (FOMO, FUD, Greed, Fear)</li>
                                <li>Menentukan Stop-Loss & Take-Profit</li>
                                <li>Menghitung Ukuran Posisi</li>
                                <li>Pentingnya Jurnal Trading</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item left">
                        <div class="timeline-item-content bg-blue-50">
                            <h3 class="font-bold text-lg text-blue-800">Tahap 5: Demo Trading (Simulasi)</h3>
                            <p class="text-sm text-gray-700">Durasi: Sampai Percaya Diri</p>
                            <p class="text-sm mt-2">Praktikkan semua yang telah Anda pelajari di lingkungan bebas risiko. Gunakan fitur simulasi di aplikasi ini!</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Menerapkan Strategi FA & TA</li>
                                <li>Melatih Disiplin & Emosi</li>
                                <li>Menguji Sistem Trading Pribadi</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item right">
                        <div class="timeline-item-content bg-red-50">
                            <h3 class="font-bold text-lg text-red-800">Tahap 6: Real Trading (dengan Hati-hati)</h3>
                            <p class="text-sm text-gray-700">Durasi: Seumur Hidup (Belajar Berkelanjutan)</p>
                            <p class="text-sm mt-2">Jika sudah percaya diri, mulailah dengan modal kecil. Pasar nyata berbeda, jadi terus belajar dan sesuaikan.</p>
                            <ul class="list-disc list-inside text-xs mt-2 text-gray-600">
                                <li>Mulai dengan Modal Kecil</li>
                                <li>Terus Belajar & Beradaptasi</li>
                                <li>Review Jurnal Trading Secara Rutin</li>
                                <li>Disiplin adalah Kunci!</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="mt-10 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Tools & Sumber Daya Rekomendasi</h3>
                    <p class="text-gray-600 mb-4">Berikut adalah beberapa alat yang akan membantu perjalanan trading Anda:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>**TradingView:** Untuk charting dan analisis teknikal profesional.</li>
                        <li>**CoinGecko / CoinMarketCap:** Untuk data harga, market cap, volume, dan riset fundamental koin.</li>
                        <li>**Metamask / Trust Wallet:** Dompet kripto non-custodial untuk menyimpan aset Anda dengan aman dan berinteraksi dengan DEX.</li>
                        <li>**Grafana (Opsional):** Untuk visualisasi data yang lebih kompleks jika Anda tertarik pada analisis lanjutan.</li>
                    </ul>
                    <p class="text-gray-600 mt-4">Anda dapat mengunduh <a href="#" class="text-indigo-600 font-semibold hover:underline">Checklist Belajar Trading Kripto (PDF)</a> untuk melacak kemajuan Anda.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Pattern Insight Modal -->
    <div id="pattern-insight-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modal-pattern-name" class="text-2xl font-bold mb-4"></h3>
            <p id="modal-pattern-desc" class="text-gray-700 mb-4"></p>
            <div id="modal-pattern-illustration" class="flex justify-center mb-4"></div>
            <button id="generate-pattern-insight-btn" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700 transition-colors">
                ‚ú® Dapatkan Insight Pola
            </button>
            <div id="pattern-insight-result" class="mt-4 p-4 bg-purple-50 rounded-lg text-purple-800 hidden">
                <p class="font-semibold mb-2">Insight AI:</p>
                <div id="pattern-insight-content" class="text-sm"></div>
            </div>
            <div id="pattern-insight-loading" class="mt-4 text-center text-purple-600 hidden">Menganalisis pola...</div>
        </div>
    </div>

    <!-- Custom Alert Modal HTML -->
    <div id="custom-alert-modal">
        <div id="custom-alert-content">
            <span id="custom-alert-close-btn">&times;</span>
            <p id="custom-alert-message" class="text-gray-700 font-semibold mb-4"></p>
            <button id="custom-alert-ok-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors">OK</button>
        </div>
    </div>

<script>
window.onload = () => {

    // Custom Alert Function
    function showAlert(message) {
        const modal = document.getElementById('custom-alert-modal');
        const messageElement = document.getElementById('custom-alert-message');
        const closeButton = document.getElementById('custom-alert-close-btn');
        const okButton = document.getElementById('custom-alert-ok-btn');

        messageElement.textContent = message;
        modal.style.display = 'flex';

        const closeAlert = () => {
            modal.style.display = 'none';
            closeButton.removeEventListener('click', closeAlert);
            okButton.removeEventListener('click', closeAlert);
            modal.removeEventListener('click', handleModalClick);
        };

        const handleModalClick = (event) => {
            if (event.target === modal) {
                closeAlert();
            }
        };

        closeButton.addEventListener('click', closeAlert);
        okButton.addEventListener('click', closeAlert);
        modal.addEventListener('click', handleModalClick);
    }

    // --- DATA STORE ---
    const appData = {
        dasar: [
            {
                title: "Apa Itu Mata Uang Kripto?",
                content: "Mata uang kripto adalah mata uang digital yang menggunakan enkripsi untuk keamanan. Tidak seperti mata uang tradisional, kripto bersifat terdesentralisasi, artinya tidak dikendalikan oleh bank atau pemerintah. Nilainya berasal dari teknologi, kelangkaan, dan kepercayaan komunitas."
            },
            {
                title: "Kekuatan Teknologi Blockchain",
                content: "Blockchain adalah buku besar digital yang terdistribusi dan tidak dapat diubah (immutable). Setiap transaksi dicatat dalam 'blok' dan dihubungkan bersama membentuk 'rantai'. Teknologi ini adalah tulang punggung yang membuat kripto aman dan transparan tanpa memerlukan pihak ketiga."
            },
            {
                title: "Jenis-Jenis Order Perdagangan",
                content: `
                    <ul class="space-y-3 list-disc list-inside">
                        <li><span class="font-semibold">Market Order:</span> Beli/jual instan pada harga pasar terbaik yang tersedia. Prioritasnya kecepatan, bukan harga.</li>
                        <li><span class="font-semibold">Limit Order:</span> Beli/jual pada harga yang Anda tentukan atau lebih baik. Memberi Anda kontrol harga, tetapi eksekusi tidak dijamin.</li>
                        <li><span class="font-semibold">Stop-Loss Order:</span> Jaring pengaman Anda. Menjual aset secara otomatis jika harga turun ke level tertentu untuk membatasi kerugian.</li>
                        <li><span class="font-semibold">Take-Profit Order:</span> Mengunci keuntungan. Menjual aset secara otomatis jika harga naik ke target keuntungan Anda.</li>
                    </ul>
                `
            }
        ],
        coins: {
            USDT: { name: 'Tether', type: 'Stablecoin' },
            BTC: { name: 'Bitcoin', type: 'Aset Inti', initialPrice: 60000 },
            ETH: { name: 'Ethereum', type: 'Aset Inti/Platform', initialPrice: 3000 },
            SOL: { name: 'Solana', type: 'Aset Inti/L1', initialPrice: 150 },
            BNB: { name: 'BNB', type: 'Utilitas/Bursa', initialPrice: 500 },
            ADA: { name: 'Cardano', type: 'Aset Inti/L1', initialPrice: 0.5 },
        },
        indicators: {
            ma50: { name: 'MA 50', type: 'overlay', color: 'rgba(255, 159, 64, 1)' },
            ma200: { name: 'MA 200', type: 'overlay', color: 'rgba(54, 162, 235, 1)' },
            bb: { name: 'Bollinger Bands', type: 'overlay', color: 'rgba(75, 192, 192, 0.2)' },
            rsi: { name: 'RSI', type: 'indicator_chart', color: 'rgba(153, 102, 255, 1)'},
            macd: { name: 'MACD', type: 'indicator_chart', color: 'rgba(255, 99, 132, 1)'}
        },
        candlestickPatterns: [
            { name: "Doji", signal: "Keraguan", desc: "Badan sangat kecil atau tidak ada, menandakan keraguan pasar dan potensi titik balik.", illustration: { type: 'doji' } },
            { name: "Hammer", signal: "Pembalikan Bullish", desc: "Terjadi setelah tren turun. Sumbu bawah panjang menunjukkan pembeli menolak harga yang lebih rendah.", illustration: { type: 'hammer' } },
            { name: "Bullish Engulfing", signal: "Pembalikan Bullish Kuat", desc: "Lilin hijau besar 'menelan' lilin merah sebelumnya, menandakan pergeseran kuat ke sentimen beli.", illustration: { type: 'bullish_engulfing' } },
            { name: "Bearish Engulfing", signal: "Pembalikan Bearish Kuat", desc: "Lilin merah besar 'menelan' lilin hijau sebelumnya, menandakan tekanan jual yang dominan.", illustration: { type: 'bearish_engulfing' } },
            { name: "Hanging Man", signal: "Pembalikan Bearish", desc: "Mirip Hammer tapi setelah tren naik. Menunjukkan penjual mulai masuk ke pasar.", illustration: { type: 'hanging_man' } },
            { name: "Shooting Star", signal: "Pembalikan Bearish", desc: "Badan kecil di bawah dengan sumbu atas panjang. Pembeli mencoba mendorong harga naik tetapi gagal.", illustration: { type: 'shooting_star' } },
        ],
        chartPatterns: [
            { name: "Head and Shoulders", type: "Pembalikan Bearish", desc: "Pola tiga puncak (puncak tengah tertinggi) yang menandakan akhir dari tren naik. Dikonfirmasi jika harga menembus 'garis leher' ke bawah." },
            { name: "Inverse Head and Shoulders", type: "Pembalikan Bullish", desc: "Kebalikan dari H&S, terbentuk setelah tren turun dan menandakan potensi pembalikan ke atas." },
            { name: "Double Top", type: "Pembalikan Bearish", desc: "Bentuk 'M' di mana harga gagal menembus level resistance dua kali. Menunjukkan kelelahan pembeli." },
            { name: "Double Bottom", type: "Pembalikan Bullish", desc: "Bentuk 'W' di mana harga memantul dari level support dua kali. Menunjukkan kekuatan pembeli." },
            { name: "Ascending Triangle", type: "Kelanjutan Bullish", desc: "Terbentuk dengan resistance datar dan support yang menanjak. Menunjukkan akumulasi oleh pembeli." },
            { name: "Descending Triangle", type: "Kelanjutan Bearish", desc: "Terbentuk dengan support datar dan resistance yang menurun. Menunjukkan tekanan jual yang meningkat." },
        ],
        psychology: [
            {
                name: "FOMO (Fear Of Missing Out)",
                emoji: "üò±",
                desc: "Dorongan untuk membeli aset yang harganya sedang meroket karena takut ketinggalan keuntungan. Seringkali berakhir dengan membeli di puncak.",
                solution: "Tetap pada rencana trading Anda. Jangan pernah masuk ke perdagangan tanpa analisis. Jika Anda terlambat, biarkan saja, akan selalu ada peluang lain."
            },
            {
                name: "Keserakahan",
                emoji: "ü§ë",
                desc: "Keinginan untuk keuntungan berlebihan, membuat Anda menahan posisi terlalu lama atau mengambil risiko yang tidak perlu.",
                solution: "Selalu tetapkan target take-profit sebelum masuk. Saat target tercapai, jangan ragu untuk mengambil keuntungan. Disiplin lebih penting dari keuntungan ekstra."
            },
            {
                name: "Panik",
                emoji: "üò∞",
                desc: "Menjual aset secara membabi bluta saat pasar turun karena ketakutan ekstrem akan kerugian yang lebih besar.",
                solution: "Gunakan stop-loss. Stop-loss adalah keputusan logis yang Anda buat saat pikiran jernih. Percayalah pada analisis Anda, bukan emosi sesaat."
            }
        ],
    };

    // --- STATE MANAGEMENT ---
    let state = {
        activeView: 'dasbor',
        activeCoin: 'BTC', // Default to BTC
        activeIndicators: {
            ma50: false,
            ma200: false,
            bb: false,
            rsi: false,
            macd: false,
        },
        // Simulation state
        simulation: {
            active: false,
            balance: 10000, // Starting USDT balance
            coinHoldings: {}, // e.g., { BTC: 0.5 }
            currentPrice: 0,
            selectedSimCoin: 'BTC',
            candleData: [], // Stores OHLC objects for ApexCharts {x: timestamp, y: [O, H, L, C]}
            volumeData: [], // Stores volume data for ApexCharts {x: timestamp, y: V}
            simChartInstance: null, // ApexCharts main instance
            simVolumeChartInstance: null, // ApexCharts volume instance
            simLastTime: Date.now(), // For ApexCharts time (milliseconds)
            simTimeframeMilliseconds: 60000, // Default 1 minute (1 candle = 1 minute) in milliseconds
            priceInterval: null,
            newsInterval: null,
            newsImpact: 0,
            newsIndex: 0,
            breakingTimeout: null,
            initialBuyPrice: 0, // To track PnL
            transactions: [], // New: Array to store transaction logs
            newsList: [
                { text: "üöÄ Binance umumkan token baru, volume naik tajam!", impact: 2 },
                { text: "‚ö†Ô∏è SEC investigasi proyek crypto besar! Pasar panik!", impact: -3 },
                { text: "üìâ Bitcoin anjlok 7% dalam 1 jam setelah tweet Elon Musk", impact: -2 },
                { text: "üì¢ Ethereum 2.0 resmi dirilis, sentimen positif kuat!", impact: 1.5 },
                { text: "üíº Investor institusi masuk ke Solana, harga melonjak.", impact: 2 }
            ]
        }
    };
    
    // --- RENDERING FUNCTIONS ---
    function render() {
        // Update view visibility
        document.querySelectorAll('.view').forEach(view => {
            view.classList.toggle('hidden', view.id !== state.activeView);
        });

        // Update nav active class
        document.querySelectorAll('.nav-item').forEach(nav => {
            nav.classList.toggle('active', nav.hash === `#${state.activeView}`);
        });

        // Only call updateSimulationUI if the simulation view is active
        if (state.activeView === 'simulasi') {
            updateSimulationUI();
            // If navigating to simulation and chart is not initialized, initialize it
            if (!state.simulation.simChartInstance) {
                initializeSimChart();
            }
        } else {
            // Stop simulation intervals if leaving the simulation view
            stopSimulationChart();
            stopNewsGeneration(); // Stop news generation when leaving simulation
        }
    }

    function init() {
        // Initial setup functions
        setupNavigation();
        populateDasarContent(); // This function now primarily handles static content or can be removed if content is directly in HTML
        populatePatternLibraries();
        populatePsychologyContent();
        setupRiskCalculators();
        setupGeminiFeatures(); // New function for Gemini features
        setupSimulation(); // New function for simulation
        insertCandlestickExamples(); // Call this after DOM is loaded and function is defined
        setupSimulationQuiz(); // Setup quiz for simulation section
        setupCoinChecklist(); // Setup coin checklist for new section

        // Set initial view
        const initialView = window.location.hash ? window.location.hash.substring(1) : 'dasbor';
        state.activeView = initialView;
        render();
    }
    
    function setupNavigation() {
        document.querySelectorAll('.nav-item, .nav-direct').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default anchor link behavior
                const viewId = e.currentTarget.hash.substring(1);
                state.activeView = viewId; // Update the active view in state
                window.location.hash = viewId; // Update URL hash for direct linking/bookmarks
                render(); // Re-render the UI based on the new activeView
            });
        });
        // This listener handles direct URL hash changes (e.g., user types #simulasi in browser bar)
        window.addEventListener('hashchange', () => {
            const viewId = window.location.hash ? window.location.hash.substring(1) : 'dasbor';
            // Only update state.activeView and render if the hash has actually changed to a different view
            // to avoid redundant renders or conflicts with click events.
            if (state.activeView !== viewId) {
                state.activeView = viewId;
                render();
            }
        });
    }

    function populateDasarContent() {
        // This function now primarily handles static content or can be removed if content is directly in HTML
        // For now, it's empty as the content is directly in the HTML structure.
    }
    
    function populatePatternLibraries() {
        const candlestickContainer = document.getElementById('candlestick-patterns-container');
        if (candlestickContainer) { // Add null check
            candlestickContainer.innerHTML = appData.candlestickPatterns.map((p, index) => `
                <div class="bg-white p-4 rounded-lg shadow-sm cursor-pointer hover:shadow-md transition-shadow pattern-card" data-pattern-type="candlestick" data-pattern-index="${index}">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold">${p.name}</h4>
                            <p class="text-sm font-semibold ${p.signal.includes('Bullish') ? 'text-green-600' : 'text-red-600'}">${p.signal}</p>
                        </div>
                        <div class="candlestick-illustration">${generateCandlestickIllustration(p.illustration)}</div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">${p.desc}</p>
                </div>
            `).join('');
        }

        const chartPatternContainer = document.getElementById('chart-patterns-container');
        if (chartPatternContainer) { // Add null check
            chartPatternContainer.innerHTML = appData.chartPatterns.map((p, index) => `
                <div class="bg-white p-6 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-shadow pattern-card" data-pattern-type="chart" data-pattern-index="${index}">
                    <h4 class="font-bold text-lg mb-1">${p.name}</h4>
                    <p class="text-sm font-semibold mb-2 ${p.type.includes('Bullish') ? 'text-green-600' : 'text-red-600'}">${p.type}</p>
                    <p class="text-sm text-gray-600">${p.desc}</p>
                </div>
            `).join('');
        }

        document.querySelectorAll('.pattern-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const type = e.currentTarget.dataset.patternType;
                const index = parseInt(e.currentTarget.dataset.patternIndex);
                const pattern = type === 'candlestick' ? appData.candlestickPatterns[index] : appData.chartPatterns[index];
                showPatternInsightModal(pattern, type);
            });
        });
    }

    function generateCandlestickIllustration(illustration) {
        let candles = [];
        const baseClass = "candlestick";
        switch (illustration.type) {
            case 'doji':
                candles.push(`<div class="${baseClass} green"><div class="wick" style="height: 15px;"></div><div class="body" style="height: 2px;"></div><div class="wick" style="height: 15px;"></div></div>`);
                break;
            case 'hammer':
                candles.push(`<div class="${baseClass} green"><div class="wick" style="height: 2px;"></div><div class="body" style="height: 8px;"></div><div class="wick" style="height: 25px;"></div></div>`);
                break;
            case 'bullish_engulfing':
                candles.push(`<div class="${baseClass} red" style="transform: scale(0.8);"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 15px;"></div><div class="wick" style="height: 5px;"></div></div>`);
                candles.push(`<div class="${baseClass} green"><div class="wick" style="height: 2px;"></div><div class="body" style="height: 30px;"></div><div class="wick" style="height: 2px;"></div></div>`);
                break;
            case 'bearish_engulfing':
                candles.push(`<div class="${baseClass} green" style="transform: scale(0.8);"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 15px;"></div><div class="wick" style="height: 5px;"></div></div>`);
                candles.push(`<div class="${baseClass} red"><div class="wick" style="height: 2px;"></div><div class="body" style="height: 30px;"></div><div class="wick" style="height: 2px;"></div></div>`);
                break;
            case 'hanging_man':
                candles.push(`<div class="${baseClass} red"><div class="wick" style="height: 2px;"></div><div class="body" style="height: 8px;"></div><div class="wick" style="height: 25px;"></div></div>`);
                break;
            case 'shooting_star':
                 candles.push(`<div class="${baseClass} red"><div class="wick" style="height: 25px;"></div><div class="body" style="height: 8px;"></div><div class="wick" style="height: 2px;"></div></div>`);
                break;
            case 'bullish_example': // New example for general bullish candle
                candles.push(`<div class="${baseClass} green"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 20px;"></div><div class="wick" style="height: 5px;"></div></div>`);
                break;
            case 'bearish_example': // New example for general bearish candle
                candles.push(`<div class="${baseClass} red"><div class="wick" style="height: 5px;"></div><div class="body" style="height: 20px;"></div><div class="wick" style="height: 5px;"></div></div>`);
                break;
        }
        return `<div class="flex items-end h-12">${candles.join('')}</div>`;
    }

    // Function to insert candlestick examples into their respective containers
    function insertCandlestickExamples() {
        const simExamplesContainer = document.getElementById('sim-candlestick-examples');
        if (simExamplesContainer) {
            simExamplesContainer.innerHTML = 
                generateCandlestickIllustration({type: 'bullish_example'}) +
                generateCandlestickIllustration({type: 'bearish_example'});
        }
    }

    function populatePsychologyContent() {
        const container = document.getElementById('psychology-content');
        if (container) { // Add null check
            container.innerHTML = appData.psychology.map(p => `
                <div class="mb-5">
                    <h4 class="font-semibold text-lg mb-2 flex items-center">${p.emoji} <span class="ml-2">${p.name}</span></h4>
                    <p class="text-gray-600 text-sm mb-2">${p.desc}</p>
                    <div class="bg-indigo-50 text-indigo-800 p-3 rounded-lg text-sm">
                        <strong class="font-semibold">Solusi:</strong> ${p.solution}
                    </div>
                </div>
            `).join('');
        }
    }

    function setupRiskCalculators() {
        const inputsPosSize = ['pos-size-account', 'pos-size-risk', 'pos-size-entry', 'pos-size-sl'];
        const inputsRR = ['rr-entry', 'rr-tp', 'rr-sl'];
        
        inputsPosSize.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', calculatePositionSize);
        });
        inputsRR.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', calculateRiskReward);
        });
    }

    function calculatePositionSize() {
        const accountSize = parseFloat(document.getElementById('pos-size-account').value);
        const riskPercent = parseFloat(document.getElementById('pos-size-risk').value);
        const entryPrice = parseFloat(document.getElementById('pos-size-entry').value);
        const slPrice = parseFloat(document.getElementById('pos-size-sl').value);
        const resultEl = document.getElementById('pos-size-result');

        if (isNaN(accountSize) || isNaN(riskPercent) || isNaN(entryPrice) || isNaN(slPrice) || entryPrice <= slPrice) {
            if (resultEl) {
                showAlert("Masukkan semua nilai yang valid untuk Ukuran Posisi."); 
                resultEl.innerHTML = "Masukkan semua nilai yang valid.";
                resultEl.className = "mt-4 text-center bg-red-50 p-3 rounded-lg font-semibold text-red-800";
            }
            return;
        }

        const riskAmount = accountSize * (riskPercent / 100);
        const riskPerShare = entryPrice - slPrice;
        const positionSize = riskAmount / riskPerShare;

        if (resultEl) {
            resultEl.innerHTML = `Beli ${positionSize.toFixed(4)} unit (${(positionSize * entryPrice).toLocaleString('id-ID', {style:'currency', currency:'USD', minimumFractionDigits: 2})})`;
            resultEl.className = "mt-4 text-center bg-indigo-50 p-3 rounded-lg font-semibold text-indigo-800";
        }
    }

    function calculateRiskReward() {
        const entryPrice = parseFloat(document.getElementById('rr-entry').value);
        const tpPrice = parseFloat(document.getElementById('rr-tp').value);
        const slPrice = parseFloat(document.getElementById('rr-sl').value);
        const resultEl = document.getElementById('rr-result');

        if (isNaN(entryPrice) || isNaN(tpPrice) || isNaN(slPrice) || entryPrice <= slPrice || entryPrice >= tpPrice) {
            if (resultEl) {
                showAlert("Masukkan semua nilai yang valid untuk Rasio Risiko-Imbalan."); 
                resultEl.innerHTML = "Masukkan semua nilai yang valid.";
                resultEl.className = "mt-4 text-center bg-red-50 p-3 rounded-lg font-semibold text-red-800";
            }
            return;
        }

        const potentialReward = tpPrice - entryPrice;
        const potentialRisk = entryPrice - slPrice;
        const ratio = potentialReward / potentialRisk;

        let className = "mt-4 text-center p-3 rounded-lg font-semibold ";
        if(ratio >= 2) {
            className += "bg-green-50 text-green-800";
        } else if (ratio >= 1) {
            className += "bg-yellow-50 text-yellow-800";
        } else {
             className += "bg-red-50 text-red-800";
        }
        if (resultEl) {
            resultEl.className = className;
            resultEl.innerHTML = `Rasio 1 : ${ratio.toFixed(2)} ${ratio >= 2 ? 'üëç' : (ratio >= 1 ? 'ü§î' : 'üëé')}`;
        }
    }

    // --- GEMINI API INTEGRATION ---
    async function callGeminiAPI(prompt) {
        const apiKey = "AIzaSyAq0Yfk9DucUsEB1QqMxOsJE9UfJPkafSc"; // IMPORTANT: For a public website, you should secure this API key on a server-side or serverless function.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        
        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = { contents: chatHistory };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                return "Maaf, saya tidak dapat menghasilkan insight saat ini. Coba lagi nanti.";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return "Terjadi kesalahan saat menghubungi AI. Periksa koneksi internet Anda.";
        }
    }

    function setupGeminiFeatures() {
        // Trade Idea Generator
        const generateTradeIdeaBtn = document.getElementById('generate-trade-idea-btn');
        const tradeIdeaResultDiv = document.getElementById('trade-idea-result');
        const tradeIdeaContentDiv = document.getElementById('trade-idea-content');
        const tradeIdeaLoadingDiv = document.getElementById('trade-idea-loading');

        if (generateTradeIdeaBtn) { // Add null check
            generateTradeIdeaBtn.addEventListener('click', async () => {
                if (tradeIdeaResultDiv) tradeIdeaResultDiv.classList.add('hidden');
                if (tradeIdeaLoadingDiv) tradeIdeaLoadingDiv.classList.remove('hidden');
                if (tradeIdeaContentDiv) tradeIdeaContentDiv.innerHTML = '';

                const coinName = "koin kripto yang sedang Anda analisis";
                const prompt = `Berikan ide trading hipotetis (entry, stop-loss, take-profit, dan alasan singkat) untuk ${coinName} di pasar kripto. Anggap pasar sedang dalam tren acak. Format respons sebagai poin-poin.`;

                const idea = await callGeminiAPI(prompt);
                if (tradeIdeaContentDiv) tradeIdeaContentDiv.innerHTML = idea;
                if (tradeIdeaLoadingDiv) tradeIdeaLoadingDiv.classList.add('hidden');
                if (tradeIdeaResultDiv) tradeIdeaResultDiv.classList.remove('hidden');
            });
        }

        // Market Sentiment Generator
        const generateSentimentBtn = document.getElementById('generate-sentiment-btn');
        const sentimentResultDiv = document.getElementById('sentiment-result');
        const sentimentContentDiv = document.getElementById('sentiment-content');
        const sentimentLoadingDiv = document.getElementById('sentiment-loading');

        if (generateSentimentBtn) { // Add null check
            generateSentimentBtn.addEventListener('click', async () => {
                if (sentimentResultDiv) sentimentResultDiv.classList.add('hidden');
                if (sentimentLoadingDiv) sentimentLoadingDiv.classList.remove('hidden');
                if (sentimentContentDiv) sentimentContentDiv.innerHTML = '';

                const coinName = "koin kripto yang sedang Anda analisis";
                const prompt = `Berikan analisis sentimen pasar (bullish, bearish, atau netral) singkat untuk ${coinName} di pasar kripto saat ini, beserta alasan singkatnya. Anggap Anda adalah analis pasar yang menyederhanakan informasi untuk pemula.`;

                const sentiment = await callGeminiAPI(prompt);
                if (sentimentContentDiv) sentimentContentDiv.innerHTML = sentiment;
                if (sentimentLoadingDiv) sentimentLoadingDiv.classList.add('hidden');
                if (sentimentResultDiv) sentimentResultDiv.classList.remove('hidden');
            });
        }

        // Ask AI Expert
        const askAiBtn = document.getElementById('ask-ai-btn');
        const aiQuestionInput = document.getElementById('ai-question-input');
        const aiAnswerResultDiv = document.getElementById('ai-answer-result');
        const aiAnswerContentDiv = document.getElementById('ai-answer-content');
        const aiAnswerLoadingDiv = document.getElementById('ai-answer-loading');

        if (askAiBtn) { // Add null check
            askAiBtn.addEventListener('click', async () => {
                const question = aiQuestionInput ? aiQuestionInput.value.trim() : '';
                if (!question) {
                    if (aiAnswerResultDiv) {
                        aiAnswerResultDiv.classList.remove('hidden');
                        aiAnswerResultDiv.className = "mt-4 p-4 bg-red-50 rounded-lg text-red-800";
                    }
                    if (aiAnswerContentDiv) aiAnswerContentDiv.innerHTML = "Mohon masukkan pertanyaan Anda.";
                    return;
                }

                if (aiAnswerResultDiv) aiAnswerResultDiv.classList.add('hidden');
                if (aiAnswerLoadingDiv) aiAnswerLoadingDiv.classList.remove('hidden');
                if (aiAnswerContentDiv) aiAnswerContentDiv.innerHTML = '';

                const prompt = `Sebagai ahli trading kripto, jelaskan "${question}" dengan bahasa yang mudah dimengerti oleh pemula berusia 14 tahun, fokus pada konsep dasar kripto. Jangan gunakan jargon yang tidak perlu.`;

                const answer = await callGeminiAPI(prompt);
                if (aiAnswerContentDiv) aiAnswerContentDiv.innerHTML = answer;
                if (aiAnswerLoadingDiv) aiAnswerLoadingDiv.classList.add('hidden');
                if (aiAnswerResultDiv) {
                    aiAnswerResultDiv.classList.remove('hidden');
                    aiAnswerResultDiv.className = "mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800";
                }
            });
        }

        // Simulate Scenario
        const simulateScenarioBtn = document.getElementById('simulate-scenario-btn');
        const scenarioInput = document.getElementById('scenario-input');
        const scenarioResultDiv = document.getElementById('scenario-result');
        const scenarioContentDiv = document.getElementById('scenario-content');
        const scenarioLoadingDiv = document.getElementById('scenario-loading');

        if (simulateScenarioBtn) { // Add null check
            simulateScenarioBtn.addEventListener('click', async () => {
                const scenario = scenarioInput ? scenarioInput.value.trim() : '';
                if (!scenario) {
                    if (scenarioResultDiv) {
                        scenarioResultDiv.classList.remove('hidden');
                        scenarioResultDiv.className = "mt-4 p-4 bg-red-50 rounded-lg text-red-800";
                    }
                    if (scenarioContentDiv) scenarioContentDiv.innerHTML = "Mohon masukkan skenario yang ingin disimulasikan.";
                    return;
                }

                if (scenarioResultDiv) scenarioResultDiv.classList.add('hidden');
                if (scenarioLoadingDiv) scenarioLoadingDiv.classList.remove('hidden');
                if (scenarioContentDiv) scenarioContentDiv.innerHTML = '';

                const coinName = "koin kripto yang sedang Anda analisis";
                const prompt = `Sebagai ahli trading kripto, jelaskan bagaimana seorang trader mungkin bereaksi dan apa yang harus diperhatikan jika "${scenario}" terjadi pada ${coinName}. Fokus pada analisis teknis dan manajemen risiko. Jelaskan dengan bahasa yang mudah dipahami pemula.`;

                const response = await callGeminiAPI(prompt);
                if (scenarioContentDiv) scenarioContentDiv.innerHTML = response;
                if (scenarioLoadingDiv) scenarioLoadingDiv.classList.add('hidden');
                if (scenarioResultDiv) {
                    scenarioResultDiv.classList.remove('hidden');
                    scenarioResultDiv.className = "mt-4 p-4 bg-purple-50 rounded-lg text-purple-800";
                }
            });
        }

        // Generate News Summary
        const generateNewsSummaryBtn = document.getElementById('generate-news-summary-btn');
        const newsSummaryResultDiv = document.getElementById('news-summary-result');
        const newsSummaryContentDiv = document.getElementById('news-summary-content');
        const newsSummaryLoadingDiv = document.getElementById('news-summary-loading');

        if (generateNewsSummaryBtn) { // Add null check
            generateNewsSummaryBtn.addEventListener('click', async () => {
                if (newsSummaryResultDiv) newsSummaryResultDiv.classList.add('hidden');
                if (newsSummaryLoadingDiv) newsSummaryLoadingDiv.classList.remove('hidden');
                if (newsSummaryContentDiv) newsSummaryContentDiv.innerHTML = '';

                const coinName = "koin kripto yang sedang Anda analisis";
                const prompt = `Sebagai analis pasar kripto, berikan ringkasan berita hipotetis singkat (1-2 paragraf) yang relevan dengan ${coinName} dan jelaskan bagaimana berita tersebut dapat mempengaruhi harganya secara umum. Fokus pada dampak fundamental dan sentimen pasar. Gunakan bahasa yang mudah dipahami pemula.`;

                const summary = await callGeminiAPI(prompt);
                if (newsSummaryContentDiv) newsSummaryContentDiv.innerHTML = summary;
                if (newsSummaryLoadingDiv) newsSummaryLoadingDiv.classList.add('hidden');
                if (newsSummaryResultDiv) {
                    newsSummaryResultDiv.classList.remove('hidden');
                    newsSummaryResultDiv.className = "mt-4 p-4 bg-blue-50 rounded-lg text-blue-800";
                }
            });
        }

        // Explain Jargon
        const explainJargonBtn = document.getElementById('explain-jargon-btn');
        const jargonInput = document.getElementById('jargon-input');
        const jargonResultDiv = document.getElementById('jargon-result');
        const jargonContentDiv = document.getElementById('jargon-content');
        const jargonLoadingDiv = document.getElementById('jargon-loading');

        if (explainJargonBtn) { // Add null check
            explainJargonBtn.addEventListener('click', async () => {
                const jargon = jargonInput ? jargonInput.value.trim() : '';
                if (!jargon) {
                    if (jargonResultDiv) {
                        jargonResultDiv.classList.remove('hidden');
                        jargonResultDiv.className = "mt-4 p-4 bg-red-50 rounded-lg text-red-800";
                    }
                    if (jargonContentDiv) jargonContentDiv.innerHTML = "Mohon masukkan jargon yang ingin dijelaskan.";
                    return;
                }

                if (jargonResultDiv) jargonResultDiv.classList.add('hidden');
                if (jargonLoadingDiv) jargonLoadingDiv.classList.remove('hidden');
                if (jargonContentDiv) jargonContentDiv.innerHTML = '';

                const prompt = `Jelaskan istilah kripto "${jargon}" dengan bahasa yang sangat sederhana dan mudah dimengerti oleh pemula berusia 14 tahun. Berikan analogi singkat jika memungkinkan.`;

                const explanation = await callGeminiAPI(prompt);
                if (jargonContentDiv) jargonContentDiv.innerHTML = explanation;
                if (jargonLoadingDiv) jargonLoadingDiv.classList.add('hidden');
                if (jargonResultDiv) {
                    jargonResultDiv.classList.remove('hidden');
                    jargonResultDiv.className = "mt-4 p-4 bg-purple-50 rounded-lg text-purple-800";
                }
            });
        }

        // Predict Trend
        const predictTrendBtn = document.getElementById('predict-trend-btn');
        const trendPredictionResultDiv = document.getElementById('trend-prediction-result');
        const trendPredictionContentDiv = document.getElementById('trend-prediction-content');
        const trendPredictionLoadingDiv = document.getElementById('trend-prediction-loading');

        if (predictTrendBtn) { // Add null check
            predictTrendBtn.addEventListener('click', async () => {
                if (trendPredictionResultDiv) trendPredictionResultDiv.classList.add('hidden');
                if (trendPredictionLoadingDiv) trendPredictionLoadingDiv.classList.remove('hidden');
                if (trendPredictionContentDiv) trendPredictionContentDiv.innerHTML = '';

                const coinName = "koin kripto yang sedang Anda analisis";
                const prompt = `Sebagai analis pasar kripto, berikan prediksi tren jangka pendek (misalnya, bullish, bearish, atau sideways) untuk ${coinName} dan berikan alasan hipotetis yang sangat sederhana. Ingat, ini hanya untuk tujuan edukasi dan bukan nasihat finansial.`;

                const prediction = await callGeminiAPI(prompt);
                if (trendPredictionContentDiv) trendPredictionContentDiv.innerHTML = prediction;
                if (trendPredictionLoadingDiv) trendPredictionLoadingDiv.classList.add('hidden');
                if (trendPredictionResultDiv) {
                    trendPredictionResultDiv.classList.remove('hidden');
                    trendPredictionResultDiv.className = "mt-4 p-4 bg-orange-50 rounded-lg text-orange-800";
                }
            });
        }
    }

    function showPatternInsightModal(pattern, type) {
        const modal = document.getElementById('pattern-insight-modal');
        const modalPatternName = document.getElementById('modal-pattern-name');
        const modalPatternDesc = document.getElementById('modal-pattern-desc');
        const illustrationContainer = document.getElementById('modal-pattern-illustration');
        const patternInsightResult = document.getElementById('pattern-insight-result');
        const patternInsightLoading = document.getElementById('pattern-insight-loading');
        const patternInsightContent = document.getElementById('pattern-insight-content');

        if (modalPatternName) modalPatternName.textContent = pattern.name;
        if (modalPatternDesc) modalPatternDesc.textContent = pattern.desc;
        
        if (illustrationContainer) {
            illustrationContainer.innerHTML = '';
            if (type === 'candlestick' && pattern.illustration) {
                illustrationContainer.innerHTML = generateCandlestickIllustration(pattern.illustration);
            } else {
                illustrationContainer.innerHTML = '<p class="text-gray-500 text-sm">Ilustrasi pola grafik tidak tersedia di sini.</p>';
            }
        }

        if (patternInsightResult) patternInsightResult.classList.add('hidden');
        if (patternInsightLoading) patternInsightLoading.classList.add('hidden');
        if (patternInsightContent) patternInsightContent.innerHTML = '';

        if (modal) modal.style.display = 'flex';
    }

    // --- SIMULATION LOGIC ---
    function setupSimulation() {
        const simCoinSelect = document.getElementById('sim-coin-select');
        const allowedCoins = ['BTC', 'ETH', 'SOL', 'BNB', 'ADA'];
        if (simCoinSelect) { // Add null check
            simCoinSelect.innerHTML = allowedCoins.map(key => 
                `<option value="${key}" ${key === state.simulation.selectedSimCoin ? 'selected' : ''}>${appData.coins[key].name} (${key})</option>`
            ).join('');
            simCoinSelect.addEventListener('change', (e) => {
                state.simulation.selectedSimCoin = e.target.value;
                const simCurrentCoinDisplay = document.getElementById('sim-current-coin-display');
                const simHoldingCoinDisplay = document.getElementById('sim-holding-coin-display');
                const buyCoinDisplay = document.getElementById('buy-coin-display');
                const sellCoinDisplay = document.getElementById('sell-coin-display');

                if (simCurrentCoinDisplay) simCurrentCoinDisplay.textContent = e.target.value;
                if (simHoldingCoinDisplay) simHoldingCoinDisplay.textContent = e.target.value;
                if (buyCoinDisplay) buyCoinDisplay.textContent = e.target.value;
                if (sellCoinDisplay) sellCoinDisplay.textContent = e.target.value;
                resetSimulation();
            });
        }

        const simStartSimBtn = document.getElementById('sim-start-sim-btn');
        if (simStartSimBtn) simStartSimBtn.addEventListener('click', startOverallSimulation);
        
        const simResetSimBtn = document.getElementById('sim-reset-sim-btn');
        if (simResetSimBtn) simResetSimBtn.addEventListener('click', resetSimulation);
        
        const buyBtn = document.getElementById('buy-btn');
        if (buyBtn) buyBtn.addEventListener('click', buyCoin);
        
        const sellBtn = document.getElementById('sell-btn');
        if (sellBtn) sellBtn.addEventListener('click', sellCoin);

        // ApexCharts specific controls
        const simTimeframe = document.getElementById("sim-timeframe");
        if (simTimeframe) { // Add null check
            simTimeframe.addEventListener("change", () => {
                state.simulation.simTimeframeMilliseconds = parseInt(simTimeframe.value);
                // Re-initialize chart with new timeframe and restart simulation
                stopSimulationChart(); 
                initializeSimChart();
                startSimulationChart();
            });
        }

        const simChartPauseBtn = document.getElementById("sim-chart-pauseBtn");
        if (simChartPauseBtn) simChartPauseBtn.addEventListener("click", pauseSim);
        
        const simChartResumeBtn = document.getElementById("sim-chart-resumeBtn");
        if (simChartResumeBtn) simChartResumeBtn.addEventListener("click", resumeSim);

        // New AI feature buttons
        const analyzeTradeBtn = document.getElementById('analyze-trade-btn');
        if (analyzeTradeBtn) analyzeTradeBtn.addEventListener('click', analyzeLastTrade);
        
        const suggestStrategyBtn = document.getElementById('suggest-strategy-btn');
        if (suggestStrategyBtn) suggestStrategyBtn.addEventListener('click', suggestStrategy);
        
        const evaluatePortfolioBtn = document.getElementById('evaluate-portfolio-btn');
        if (evaluatePortfolioBtn) evaluatePortfolioBtn.addEventListener('click', evaluatePortfolio);

        updateSimulationUI();
        renderTransactionLog();
    }

    // Initialize ApexCharts for simulation
    function initializeSimChart() {
        if (typeof ApexCharts === 'undefined' || !ApexCharts) {
            console.error("ApexCharts library is not loaded or not properly initialized.");
            return;
        }

        const chartElement = document.getElementById('chart');
        const volumeChartElement = document.getElementById('volumeChart');
        if (!chartElement || !volumeChartElement) {
            console.error("Error: Chart elements not found for ApexCharts initialization. This might happen if the simulation section is not active.");
            // Do not call updateSimulationUI here if elements are null, as it will cause errors.
            return;
        }

        // Destroy existing charts if they exist
        if (state.simulation.simChartInstance) {
            state.simulation.simChartInstance.destroy();
            state.simulation.simChartInstance = null;
        }
        if (state.simulation.simVolumeChartInstance) {
            state.simulation.simVolumeChartInstance.destroy();
            state.simulation.simVolumeChartInstance = null;
        }

        const chartWidth = chartElement.clientWidth;
        const chartHeight = chartElement.clientHeight;

        if (chartWidth === 0 || chartHeight === 0) {
            console.warn("Chart element has zero dimensions. Deferring ApexCharts initialization. Current dimensions:", chartWidth, chartHeight);
            setTimeout(() => initializeSimChart(), 100);
            return;
        }

        console.log("Attempting to initialize sim chart with dimensions:", chartWidth, chartHeight);

        try {
            const initialData = generateInitialSimData(50); // Generate initial 50 candles
            state.simulation.candleData = initialData.candles;
            state.simulation.volumeData = initialData.volumes;
            state.simulation.simLastTime = initialData.lastTime; // Update last time after initial data generation

            const chartOptions = {
                series: [{
                    data: state.simulation.candleData
                }],
                chart: {
                    type: 'candlestick',
                    height: chartHeight,
                    width: '100%',
                    animations: {
                        enabled: false // Disable animations for real-time updates
                    },
                    toolbar: {
                        show: false
                    },
                    zoom: {
                        enabled: true
                    }
                },
                xaxis: {
                    type: 'datetime',
                    labels: {
                        formatter: function(val) {
                            return new Date(val).toLocaleString();
                        },
                        style: {
                            colors: '#334155' // Darker text for light background
                        }
                    }
                },
                yaxis: {
                    tooltip: {
                        enabled: true
                    },
                    labels: {
                        style: {
                            colors: '#334155' // Darker text for light background
                        }
                    }
                },
                plotOptions: {
                    candlestick: {
                        colors: {
                            upward: '#22C55E',   // Green
                            downward: '#EF4444' // Red
                        }
                    }
                },
                grid: {
                    borderColor: '#e0e0e0',
                },
                tooltip: {
                    x: {
                        format: 'dd MMM HH:mm'
                    }
                }
            };

            const volumeChartOptions = {
                series: [{
                    name: 'Volume',
                    data: state.simulation.volumeData
                }],
                chart: {
                    type: 'bar',
                    height: 150,
                    width: '100%',
                    animations: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    },
                    zoom: {
                        enabled: true
                    }
                },
                xaxis: {
                    type: 'datetime',
                    labels: {
                        formatter: function(val) {
                            return new Date(val).toLocaleString();
                        },
                        style: {
                            colors: '#334155' // Darker text for light background
                        }
                    }
                },
                yaxis: {
                    labels: {
                        style: {
                            colors: '#334155' // Darker text for light background
                        }
                    }
                },
                colors: ['#3b82f6'], // Blue for volume bars
                grid: {
                    borderColor: '#e0e0e0',
                },
                tooltip: {
                    x: {
                        format: 'dd MMM HH:mm'
                    }
                }
            };

            state.simulation.simChartInstance = new ApexCharts(chartElement, chartOptions);
            state.simulation.simChartInstance.render();

            state.simulation.simVolumeChartInstance = new ApexCharts(volumeChartElement, volumeChartOptions);
            state.simulation.simVolumeChartInstance.render();

            // Set current price from the last candle
            if (state.simulation.candleData.length > 0) {
                state.simulation.currentPrice = state.simulation.candleData[state.simulation.candleData.length - 1].y[3]; // Close price
            }
            updateSimulationUI(); // Now it's safe to call this after charts are rendered

        } catch (error) {
            console.error("Error during ApexCharts initialization:", error);
            state.simulation.simChartInstance = null;
            state.simulation.simVolumeChartInstance = null;
        }
    }

    // Generate a new candle and volume data point for ApexCharts
    function getNextSimData(lastKnownPrice) {
        const volatilityFactor = 0.005; // Base volatility (0.5% up/down)
        const eventImpactFactor = state.simulation.newsImpact * 0.005; // News impact (e.g., 2 -> 1% impact)

        let open = lastKnownPrice;
        if (!open) {
            open = appData.coins[state.simulation.selectedSimCoin].initialPrice;
        }
        
        let close = open * (1 + (Math.random() - 0.5) * volatilityFactor * 2 + eventImpactFactor);
        
        if (state.simulation.selectedSimCoin === 'ADA') {
            if (close < 0.00001) close = 0.00001;
        } else {
            if (close < 0.01) close = 0.01;
        }

        let high = Math.max(open, close) * (1 + Math.random() * 0.002);
        let low = Math.min(open, close) * (1 - Math.random() * 0.002);

        const time = state.simulation.simLastTime + state.simulation.simTimeframeMilliseconds;

        state.simulation.simLastTime = time;
        state.simulation.currentPrice = close;

        const volume = Math.floor(Math.random() * 100 + 10 + Math.abs(state.simulation.newsImpact) * 50); // Volume also impacted by news

        return {
            candle: {
                x: new Date(time),
                y: [open, high, low, close].map(val => parseFloat(val.toFixed(6)))
            },
            volume: {
                x: new Date(time),
                y: volume
            }
        };
    }

    // Generate initial data for ApexCharts
    function generateInitialSimData(numCandles = 50) {
        const candles = [];
        const volumes = [];
        let currentTime = Date.now() - (numCandles * state.simulation.simTimeframeMilliseconds);
        let currentPriceForInit = appData.coins[state.simulation.selectedSimCoin].initialPrice;

        for (let i = 0; i < numCandles; i++) {
            const open = currentPriceForInit;
            const close = open * (1 + (Math.random() - 0.5) * 0.01);
            const high = Math.max(open, close) * (1 + Math.random() * 0.002);
            const low = Math.min(open, close) * (1 - Math.random() * 0.002);
            const volume = Math.floor(Math.random() * 100 + 10);

            candles.push({
                x: new Date(currentTime),
                y: [open, high, low, close].map(val => parseFloat(val.toFixed(6)))
            });
            volumes.push({
                x: new Date(currentTime),
                y: volume
            });
            currentPriceForInit = close;
            currentTime += state.simulation.simTimeframeMilliseconds;
        }
        return { candles, volumes, lastTime: currentTime };
    }

    // Start the ApexCharts candlestick and volume simulation
    function startSimulationChart() {
        if (state.simulation.priceInterval) return;

        if (!state.simulation.simChartInstance || !state.simulation.simVolumeChartInstance) {
            console.warn("Charts not initialized. Attempting to initialize...");
            initializeSimChart();
            if (!state.simulation.simChartInstance || !state.simulation.simVolumeChartInstance) {
                console.error("Failed to initialize charts after retry. Cannot start simulation.");
                return;
            }
        }

        state.simulation.priceInterval = setInterval(() => {
            const lastCandle = state.simulation.candleData[state.simulation.candleData.length - 1];
            const newSimData = getNextSimData(lastCandle ? lastCandle.y[3] : null);
            
            state.simulation.candleData.push(newSimData.candle);
            state.simulation.volumeData.push(newSimData.volume);
            
            const maxCandles = 60; // Keep roughly 60 candles visible
            if (state.simulation.candleData.length > maxCandles) {
                state.simulation.candleData.shift();
                state.simulation.volumeData.shift();
            }

            if (state.simulation.simChartInstance && state.simulation.simVolumeChartInstance) {
                state.simulation.simChartInstance.updateSeries([{ data: state.simulation.candleData }]);
                state.simulation.simVolumeChartInstance.updateSeries([{ data: state.simulation.volumeData }]);
            } else {
                console.error("Chart instances are null. Cannot update charts.");
                stopSimulationChart();
                return;
            }
            updateSimulationUI();
        }, 1000); // Update every 1 second

        startNewsGeneration();
    }

    // Stop the ApexCharts candlestick and volume simulation
    function stopSimulationChart() {
        if (state.simulation.priceInterval) {
            clearInterval(state.simulation.priceInterval);
            state.simulation.priceInterval = null;
        }
        stopNewsGeneration();
    }

    function pauseSim() {
        stopSimulationChart(); // Uses the same logic as stop
        console.log("Simulation paused.");
    }

    function resumeSim() {
        startSimulationChart(); // Uses the same logic as start
        console.log("Simulation resumed.");
    }

    // Overall simulation start (for balance, holdings, etc.)
    function startOverallSimulation() {
        if (state.simulation.active) return;

        state.simulation.active = true;
        state.simulation.balance = 10000;
        state.simulation.coinHoldings = {};
        state.simulation.coinHoldings[state.simulation.selectedSimCoin] = 0;
        state.simulation.initialBuyPrice = 0;
        state.simulation.newsImpact = 0; // Reset news impact
        state.simulation.transactions = [];

        const simStartSimBtn = document.getElementById('sim-start-sim-btn');
        const simResetSimBtn = document.getElementById('sim-reset-sim-btn');
        const simCoinSelect = document.getElementById('sim-coin-select');
        const simPnlInfo = document.getElementById('sim-pnl-info');
        const newsBox = document.getElementById('newsBox');

        if (simStartSimBtn) simStartSimBtn.classList.add('hidden');
        if (simResetSimBtn) simResetSimBtn.classList.remove('hidden');
        if (simCoinSelect) simCoinSelect.disabled = true;
        if (simPnlInfo) simPnlInfo.classList.add('hidden');
        if (newsBox) {
            newsBox.classList.remove('breaking');
            newsBox.textContent = "Tidak ada berita saat ini...";
        }

        initializeSimChart(); // Re-initialize charts to clear old data
        startSimulationChart();
        updateSimulationUI();
        renderTransactionLog();
    }

    function resetSimulation() {
        stopSimulationChart();
        state.simulation.active = false;
        state.simulation.balance = 10000;
        state.simulation.coinHoldings = {};
        state.simulation.coinHoldings[state.simulation.selectedSimCoin] = 0;
        state.simulation.currentPrice = 0;
        state.simulation.initialBuyPrice = 0;
        state.simulation.newsImpact = 0;
        state.simulation.transactions = [];

        if (state.simulation.simChartInstance) {
            state.simulation.simChartInstance.destroy();
            state.simulation.simChartInstance = null;
        }
        if (state.simulation.simVolumeChartInstance) {
            state.simulation.simVolumeChartInstance.destroy();
            state.simulation.simVolumeChartInstance = null;
        }
        state.simulation.candleData = [];
        state.simulation.volumeData = [];

        const simStartSimBtn = document.getElementById('sim-start-sim-btn');
        const simResetSimBtn = document.getElementById('sim-reset-sim-btn');
        const simCoinSelect = document.getElementById('sim-coin-select');
        const buyAmountInput = document.getElementById('buy-amount');
        const sellAmountInput = document.getElementById('sell-amount');
        const simPnlInfo = document.getElementById('sim-pnl-info');
        const newsBox = document.getElementById('newsBox');

        if (simStartSimBtn) simStartSimBtn.classList.remove('hidden');
        if (simResetSimBtn) simResetSimBtn.classList.add('hidden');
        if (simCoinSelect) simCoinSelect.disabled = false;
        if (buyAmountInput) buyAmountInput.value = '';
        if (sellAmountInput) sellAmountInput.value = '';
        if (simPnlInfo) simPnlInfo.classList.add('hidden');
        if (newsBox) {
            newsBox.classList.remove('breaking');
            newsBox.textContent = "Tidak ada berita saat ini...";
        }

        updateSimulationUI();
        renderTransactionLog();
    }

    function updateNews() {
        const newsChance = Math.random();
        if (newsChance < 0.2) { // 20% chance to trigger an event
            state.simulation.newsIndex = (state.simulation.newsIndex + 1) % state.simulation.newsList.length;
            const news = state.simulation.newsList[state.simulation.newsIndex];
            const newsBox = document.getElementById('newsBox');
            if (newsBox) { // Add null check
                newsBox.innerText = `üì¢ BREAKING NEWS: ${news.text}`;
                newsBox.classList.add("breaking");
            }
            state.simulation.newsImpact = news.impact;
            clearTimeout(state.simulation.breakingTimeout);
            state.simulation.breakingTimeout = setTimeout(() => {
                if (newsBox) { // Add null check
                    newsBox.innerText = "Tidak ada berita saat ini...";
                    newsBox.classList.remove("breaking");
                }
                state.simulation.newsImpact = 0;
            }, 10000); // News stays for 10 seconds
        }
    }

    function startNewsGeneration() {
        if (state.simulation.newsInterval) return;
        const minInterval = 30000; // 30 seconds
        const maxInterval = 60000; // 60 seconds
        const randomInterval = Math.floor(Math.random() * (maxInterval - minInterval + 1)) + minInterval;
        
        state.simulation.newsInterval = setInterval(updateNews, randomInterval);
        console.log(`News generation started with interval: ${randomInterval / 1000} seconds`);
    }

    function stopNewsGeneration() {
        if (state.simulation.newsInterval) {
            clearInterval(state.simulation.newsInterval);
            state.simulation.newsInterval = null;
            console.log("News generation stopped.");
        }
        if (state.simulation.breakingTimeout) {
            clearTimeout(state.simulation.breakingTimeout);
            state.simulation.breakingTimeout = null;
        }
        const newsBox = document.getElementById('newsBox');
        if (newsBox) { // Add null check
            newsBox.classList.remove('breaking');
            newsBox.textContent = "Tidak ada berita saat ini...";
        }
        state.simulation.newsImpact = 0;
    }

    function updateSimulationUI() {
        // Add null checks for all elements before accessing their properties
        const simBalance = document.getElementById('sim-balance');
        if (simBalance) {
            simBalance.textContent = state.simulation.balance.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        const simCurrentPrice = document.getElementById('sim-current-price');
        if (simCurrentPrice) {
            simCurrentPrice.textContent = state.simulation.currentPrice.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        const currentCoinHolding = state.simulation.coinHoldings[state.simulation.selectedSimCoin] || 0;
        const simCoinHolding = document.getElementById('sim-coin-holding');
        if (simCoinHolding) {
            simCoinHolding.textContent = currentCoinHolding.toFixed(4);
        }

        // Update Price, Change, Direction
        const priceElement = document.getElementById('price');
        const changeElement = document.getElementById('change');
        const directionElement = document.getElementById('direction');

        if (priceElement) { // Add null check
            priceElement.textContent = `Harga: $${state.simulation.currentPrice.toFixed(2)}`;
        }

        if (changeElement && directionElement) { // Add null checks
            if (state.simulation.candleData.length > 1) {
                const prevClose = state.simulation.candleData[state.simulation.candleData.length - 2].y[3];
                const currentClose = state.simulation.currentPrice;
                const percentageChange = ((currentClose - prevClose) / prevClose) * 100;
                changeElement.textContent = `Change: ${percentageChange.toFixed(2)}%`;
                if (percentageChange > 0) {
                    changeElement.style.color = '#22C55E'; // Green
                    directionElement.textContent = '‚ñ≤';
                    directionElement.style.color = '#22C55E';
                } else if (percentageChange < 0) {
                    changeElement.style.color = '#EF4444'; // Red
                    directionElement.textContent = '‚ñº';
                    directionElement.style.color = '#EF4444';
                } else {
                    changeElement.style.color = ''; // Reset
                    directionElement.textContent = '‚¨ç';
                    directionElement.style.color = '';
                }
            } else {
                changeElement.textContent = 'Change: 0%';
                changeElement.style.color = '';
                directionElement.textContent = '‚¨ç';
                directionElement.style.color = '';
            }
        }

        // Calculate and display PnL
        const totalValue = state.simulation.balance + currentCoinHolding * state.simulation.currentPrice;
        const totalValueElement = document.getElementById("totalValue");
        if (totalValueElement) { // Add null check
            totalValueElement.innerText = `üìà Total Value: $${totalValue.toFixed(2)}`;
        }

        const simPnl = document.getElementById('sim-pnl');
        const simPnlInfo = document.getElementById('sim-pnl-info');
        if (simPnl && simPnlInfo) { // Add null checks
            if (currentCoinHolding > 0 && state.simulation.initialBuyPrice > 0) {
                const unrealizedPnL = (state.simulation.currentPrice - state.simulation.initialBuyPrice) * currentCoinHolding;
                simPnl.textContent = unrealizedPnL.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
                simPnl.className = `text-xl font-bold ${unrealizedPnL >= 0 ? 'text-green-600' : 'text-red-600'}`;
                simPnlInfo.classList.remove('hidden');
            } else {
                simPnlInfo.classList.add('hidden');
            }
        }
    }

    function buyCoin() {
        const buyAmountInput = document.getElementById('buy-amount');
        const amountUSDT = parseFloat(buyAmountInput ? buyAmountInput.value : 0);
        if (isNaN(amountUSDT) || amountUSDT <= 0) {
            showAlert("Masukkan jumlah USDT yang valid untuk dibeli.");
            return;
        }
        if (amountUSDT > state.simulation.balance) {
            showAlert("Saldo USDT tidak cukup.");
            return;
        }
        if (state.simulation.currentPrice <= 0) {
            showAlert("Harga koin belum tersedia atau tidak valid.");
            return;
        }

        const coinAmount = amountUSDT / state.simulation.currentPrice;
        state.simulation.balance -= amountUSDT;
        state.simulation.coinHoldings[state.simulation.selectedSimCoin] = (state.simulation.coinHoldings[state.simulation.selectedSimCoin] || 0) + coinAmount;
        
        const currentHoldingBeforeBuy = state.simulation.coinHoldings[state.simulation.selectedSimCoin] - coinAmount;
        if (currentHoldingBeforeBuy > 0) {
            const totalCostBefore = state.simulation.initialBuyPrice * currentHoldingBeforeBuy;
            const newTotalCost = totalCostBefore + amountUSDT;
            state.simulation.initialBuyPrice = newTotalCost / state.simulation.coinHoldings[state.simulation.selectedSimCoin];
        } else {
            state.simulation.initialBuyPrice = state.simulation.currentPrice;
        }

        state.simulation.transactions.push({
            time: new Date().toLocaleString(),
            coin: state.simulation.selectedSimCoin,
            action: 'Beli',
            amount: coinAmount.toFixed(4),
            price: state.simulation.currentPrice.toFixed(2),
            total: amountUSDT.toFixed(2),
            pnl_percent: '-',
            pnl_usd: '-'
        });

        if (buyAmountInput) buyAmountInput.value = '';
        updateSimulationUI();
        renderTransactionLog();
    }

    function sellCoin() {
        const sellAmountInput = document.getElementById('sell-amount');
        const amountCoin = parseFloat(sellAmountInput ? sellAmountInput.value : 0);
        const currentCoinHolding = state.simulation.coinHoldings[state.simulation.selectedSimCoin] || 0;

        if (isNaN(amountCoin) || amountCoin <= 0) {
            showAlert("Masukkan jumlah koin yang valid untuk dijual.");
            return;
        }
        if (amountCoin > currentCoinHolding) {
            showAlert("Jumlah koin tidak cukup untuk dijual.");
            return;
        }
        if (state.simulation.currentPrice <= 0) {
            showAlert("Harga koin belum tersedia atau tidak valid.");
            return;
        }

        const usdtReceived = amountCoin * state.simulation.currentPrice;
        state.simulation.balance += usdtReceived;
        state.simulation.coinHoldings[state.simulation.selectedSimCoin] -= amountCoin;
        
        let pnlPercent = 0;
        let pnlUsd = 0;

        if (state.simulation.initialBuyPrice > 0) {
            pnlUsd = (state.simulation.currentPrice - state.simulation.initialBuyPrice) * amountCoin;
            pnlPercent = (pnlUsd / (state.simulation.initialBuyPrice * amountCoin)) * 100;
        }

        if (state.simulation.coinHoldings[state.simulation.selectedSimCoin] < 0.0001) {
            state.simulation.coinHoldings[state.simulation.selectedSimCoin] = 0;
            state.simulation.initialBuyPrice = 0;
        }

        state.simulation.transactions.push({
            time: new Date().toLocaleString(),
            coin: state.simulation.selectedSimCoin,
            action: 'Jual',
            amount: amountCoin.toFixed(4),
            price: state.simulation.currentPrice.toFixed(2),
            total: usdtReceived.toFixed(2),
            pnl_percent: pnlPercent.toFixed(2) + '%',
            pnl_usd: pnlUsd.toFixed(2)
        });

        if (sellAmountInput) sellAmountInput.value = '';
        updateSimulationUI();
        renderTransactionLog();
    }

    function renderTransactionLog() {
        const logBody = document.getElementById('transaction-log-body');
        if (!logBody) return; // Add null check for logBody

        logBody.innerHTML = '';

        state.simulation.transactions.slice().reverse().forEach(tx => {
            const row = logBody.insertRow();
            row.className = 'bg-white border-b';
            row.insertCell().textContent = tx.time;
            row.insertCell().textContent = tx.coin;
            row.insertCell().textContent = tx.action;
            row.insertCell().textContent = tx.amount;
            row.insertCell().textContent = `$${tx.price}`;
            row.insertCell().textContent = `$${tx.total}`;
            
            const pnlPercentCell = row.insertCell();
            pnlPercentCell.textContent = tx.pnl_percent;
            if (tx.pnl_percent !== '-') {
                pnlPercentCell.classList.add(parseFloat(tx.pnl_percent) >= 0 ? 'text-green-600' : 'text-red-600');
            }

            const pnlUsdCell = row.insertCell();
            pnlUsdCell.textContent = `$${tx.pnl_usd}`;
            if (tx.pnl_usd !== '-') {
                pnlUsdCell.classList.add(parseFloat(tx.pnl_usd) >= 0 ? 'text-green-600' : 'text-red-600');
            }
        });
    }

    // --- NEW GEMINI API FEATURES FOR SIMULATION ---

    async function analyzeLastTrade() {
        const tradeAnalysisResultDiv = document.getElementById('trade-analysis-result');
        const tradeAnalysisContentDiv = document.getElementById('trade-analysis-content');
        const tradeAnalysisLoadingDiv = document.getElementById('trade-analysis-loading');

        if (tradeAnalysisResultDiv) tradeAnalysisResultDiv.classList.add('hidden');
        if (tradeAnalysisLoadingDiv) tradeAnalysisLoadingDiv.classList.remove('hidden');
        if (tradeAnalysisContentDiv) tradeAnalysisContentDiv.innerHTML = '';

        if (state.simulation.transactions.length === 0) {
            if (tradeAnalysisResultDiv) {
                tradeAnalysisResultDiv.classList.remove('hidden');
                tradeAnalysisResultDiv.className = "mt-4 p-4 bg-yellow-50 rounded-lg text-yellow-800";
            }
            if (tradeAnalysisContentDiv) tradeAnalysisContentDiv.innerHTML = "Belum ada transaksi untuk dianalisis.";
            if (tradeAnalysisLoadingDiv) tradeAnalysisLoadingDiv.classList.add('hidden');
            return;
        }

        const lastTrade = state.simulation.transactions[state.simulation.transactions.length - 1];
        const currentPrice = state.simulation.currentPrice;
        const coinName = appData.coins[state.simulation.selectedSimCoin].name;

        let prompt = `Sebagai analis trading kripto, berikan analisis singkat (1-2 paragraf) tentang transaksi terakhir ini:\n`;
        prompt += `- Aksi: ${lastTrade.action}\n`;
        prompt += `- Koin: ${coinName} (${lastTrade.coin})\n`;
        prompt += `- Jumlah: ${lastTrade.amount} ${lastTrade.coin}\n`;
        prompt += `- Harga Transaksi: $${lastTrade.price}\n`;
        prompt += `- Harga Saat Ini: $${currentPrice.toFixed(2)}\n`;
        if (lastTrade.pnl_usd !== '-') {
            prompt += `- Keuntungan/Kerugian: $${lastTrade.pnl_usd} (${lastTrade.pnl_percent})\n`;
        }
        prompt += `Apakah ini perdagangan yang baik atau buruk berdasarkan harga saat ini? Berikan alasan sederhana.`;

        const analysis = await callGeminiAPI(prompt);
        if (tradeAnalysisContentDiv) tradeAnalysisContentDiv.innerHTML = analysis;
        if (tradeAnalysisLoadingDiv) tradeAnalysisLoadingDiv.classList.add('hidden');
        if (tradeAnalysisResultDiv) {
            tradeAnalysisResultDiv.classList.remove('hidden');
            tradeAnalysisResultDiv.className = "mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800";
        }
    }

    async function suggestStrategy() {
        const strategySuggestionResultDiv = document.getElementById('strategy-suggestion-result');
        const strategySuggestionContentDiv = document.getElementById('strategy-suggestion-content');
        const strategySuggestionLoadingDiv = document.getElementById('strategy-suggestion-loading');

        if (strategySuggestionResultDiv) strategySuggestionResultDiv.classList.add('hidden');
        if (strategySuggestionLoadingDiv) strategySuggestionLoadingDiv.classList.remove('hidden');
        if (strategySuggestionContentDiv) strategySuggestionContentDiv.innerHTML = '';

        if (state.simulation.candleData.length < 10) {
            if (strategySuggestionResultDiv) {
                strategySuggestionResultDiv.classList.remove('hidden');
                strategySuggestionResultDiv.className = "mt-4 p-4 bg-yellow-50 rounded-lg text-yellow-800";
            }
            if (strategySuggestionContentDiv) strategySuggestionContentDiv.innerHTML = "Dibutuhkan lebih banyak data grafik untuk menyarankan strategi. Biarkan simulasi berjalan sebentar.";
            if (strategySuggestionLoadingDiv) strategySuggestionLoadingDiv.classList.add('hidden');
            return;
        }

        // Get recent price data to infer trend/volatility
        const recentCloses = state.simulation.candleData.slice(-10).map(d => d.y[3]); // Last 10 close prices
        const maxPrice = Math.max(...recentCloses);
        const minPrice = Math.min(...recentCloses);
        const priceRange = maxPrice - minPrice;
        const averagePrice = recentCloses.reduce((a, b) => a + b, 0) / recentCloses.length;

        let trend = "sideways";
        if (recentCloses[recentCloses.length - 1] > recentCloses[0] * 1.02) { // 2% up
            trend = "uptrend";
        } else if (recentCloses[recentCloses.length - 1] < recentCloses[0] * 0.98) { // 2% down
            trend = "downtrend";
        }

        let volatility = "rendah";
        if (priceRange / averagePrice > 0.03) { // 3% range
            volatility = "tinggi";
        }

        const prompt = `Berdasarkan kondisi pasar simulasi saat ini di mana harga ${state.simulation.selectedSimCoin} menunjukkan tren ${trend} dan volatilitas ${volatility}, berikan saran strategi trading umum (misalnya, strategi mengikuti tren, strategi range-bound, atau strategi breakout) yang cocok untuk pemula. Jelaskan alasannya secara singkat.`;

        const suggestion = await callGeminiAPI(prompt);
        if (strategySuggestionContentDiv) strategySuggestionContentDiv.innerHTML = suggestion;
        if (strategySuggestionLoadingDiv) strategySuggestionLoadingDiv.classList.add('hidden');
        if (strategySuggestionResultDiv) {
            strategySuggestionResultDiv.classList.remove('hidden');
            strategySuggestionResultDiv.className = "mt-4 p-4 bg-green-50 rounded-lg text-green-800";
        }
    }

    async function evaluatePortfolio() {
        const portfolioEvaluationResultDiv = document.getElementById('portfolio-evaluation-result');
        const portfolioEvaluationContentDiv = document.getElementById('portfolio-evaluation-content');
        const portfolioEvaluationLoadingDiv = document.getElementById('portfolio-evaluation-loading');

        if (portfolioEvaluationResultDiv) portfolioEvaluationResultDiv.classList.add('hidden');
        if (portfolioEvaluationLoadingDiv) portfolioEvaluationLoadingDiv.classList.remove('hidden');
        if (portfolioEvaluationContentDiv) portfolioEvaluationContentDiv.innerHTML = '';

        const currentCoinHolding = state.simulation.coinHoldings[state.simulation.selectedSimCoin] || 0;
        const totalValue = state.simulation.balance + currentCoinHolding * state.simulation.currentPrice;
        const initialBalance = 10000; // Assuming initial balance is always 10000

        let performanceStatus = "netral";
        let pnlOverall = totalValue - initialBalance;
        if (pnlOverall > 0) {
            performanceStatus = "menguntungkan";
        } else if (pnlOverall < 0) {
            performanceStatus = "merugi";
        }

        let holdingInfo = "";
        if (currentCoinHolding > 0) {
            holdingInfo = `Anda saat ini memegang ${currentCoinHolding.toFixed(4)} ${state.simulation.selectedSimCoin} dengan harga beli rata-rata $${state.simulation.initialBuyPrice.toFixed(2)}. Harga saat ini adalah $${state.simulation.currentPrice.toFixed(2)}.`;
        } else {
            holdingInfo = "Anda tidak memegang koin apapun saat ini.";
        }

        const prompt = `Sebagai penasihat trading AI, berikan evaluasi singkat (1-2 paragraf) tentang portofolio simulasi ini:\n`;
        prompt += `- Saldo USDT: $${state.simulation.balance.toFixed(2)}\n`;
        prompt += `- Total Nilai Portofolio: $${totalValue.toFixed(2)}\n`;
        prompt += `- Kinerja Keseluruhan: ${performanceStatus} (P/L: $${pnlOverall.toFixed(2)})\n`;
        prompt += `- Informasi Kepemilikan: ${holdingInfo}\n\n`;
        prompt += `Berikan saran singkat untuk meningkatkan kinerja atau mengelola risiko.`;

        const evaluation = await callGeminiAPI(prompt);
        if (portfolioEvaluationContentDiv) portfolioEvaluationContentDiv.innerHTML = evaluation;
        if (portfolioEvaluationLoadingDiv) portfolioEvaluationLoadingDiv.classList.add('hidden');
        if (portfolioEvaluationResultDiv) {
            portfolioEvaluationResultDiv.classList.remove('hidden');
            portfolioEvaluationResultDiv.className = "mt-4 p-4 bg-purple-50 rounded-lg text-purple-800";
        }
    }

    // --- NEW QUIZ LOGIC FOR SIMULATION SECTION ---
    function setupSimulationQuiz() {
        document.querySelectorAll('.quiz-answer-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const answer = e.target.dataset.answer;
                const parentDiv = e.target.closest('.p-4'); // Get the parent quiz div
                const feedbackDivId = parentDiv.querySelector('div[id^="quiz-feedback-"]').id;
                const feedbackDiv = document.getElementById(feedbackDivId);

                let isCorrect = false;
                let message = "";

                if (feedbackDivId === 'quiz-feedback-sr') {
                    if (answer === 'resistance') {
                        isCorrect = true;
                        message = "Benar! Garis putus-putus menunjukkan level Resistance, di mana harga cenderung sulit menembus ke atas.";
                    } else {
                        message = "Salah. Garis ini menunjukkan Resistance, area di mana tekanan jual kuat menghambat kenaikan harga.";
                    }
                } else if (feedbackDivId === 'quiz-feedback-breakout') {
                    if (answer === 'yes') {
                        isCorrect = true;
                        message = "Benar! Lilin bullish besar yang menembus level resistance menandakan potensi breakout yang kuat.";
                    } else {
                        message = "Salah. Lilin bullish yang kuat menembus resistance seringkali menjadi sinyal breakout.";
                    }
                }

                if (feedbackDiv) { // Add null check
                    feedbackDiv.classList.remove('hidden', 'bg-green-50', 'bg-red-50', 'text-green-800', 'text-red-800');
                    feedbackDiv.classList.add(isCorrect ? 'bg-green-50' : 'bg-red-50', isCorrect ? 'text-green-800' : 'text-red-800');
                    feedbackDiv.innerHTML = message;
                }
            });
        });
    }

    // --- NEW COIN CHECKLIST LOGIC ---
    function setupCoinChecklist() {
        const form = document.getElementById('coin-checklist-form');
        const feedbackDiv = document.getElementById('checklist-feedback');

        if (form) { // Add null check
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const checkboxes = form.querySelectorAll('input[name="criteria"]:checked');
                let checkedCount = checkboxes.length;

                let message = "";
                let className = "mt-4 p-4 rounded-lg ";

                if (checkedCount === 5) {
                    message = "Luar biasa! Anda telah mempertimbangkan semua faktor penting dalam memilih koin. Ini adalah pendekatan yang sangat baik untuk analisis fundamental.";
                    className += "bg-green-50 text-green-800";
                } else if (checkedCount >= 3) {
                    message = `Bagus! Anda telah mempertimbangkan ${checkedCount} dari 5 faktor penting. Terus tingkatkan riset Anda!`;
                    className += "bg-yellow-50 text-yellow-800";
                } else {
                    message = `Anda baru mempertimbangkan ${checkedCount} dari 5 faktor. Ingat, analisis fundamental yang kuat membutuhkan riset menyeluruh pada semua aspek proyek.`;
                    className += "bg-red-50 text-red-800";
                }

                if (feedbackDiv) { // Add null check
                    feedbackDiv.className = className;
                    feedbackDiv.innerHTML = message;
                    feedbackDiv.classList.remove('hidden');
                }
            });
        }
    }


    init();
};
</script>
</body>
</html>
